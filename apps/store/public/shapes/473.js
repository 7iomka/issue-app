"use strict";(self.webpackChunk_steklo24_shapes=self.webpackChunk_steklo24_shapes||[]).push([[473],{473:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  "createAreal": () => (/* binding */ createAreal)\n});\n\n;// CONCATENATED MODULE: ./modul_shapes/src/func.js\nfunction substitutionPath(ob) {//функция меняет всё приличное на path и определяет крайние координаты\r\nvar atrib=["style","transform","fill-rule","clip-rule","fill","stroke","stroke-width","stroke-miterlimit","clip-path","fill-opacity","stroke-dasharray","stroke-linecap","dashoffset","stroke-linecap","sroke-linejoin","onload","display","opacity"];\r\n\r\nfunction  perenos_atrib(a,b){\r\n\t\r\n\tfor (var i=0;i<atrib.length;i++) {\r\n\t\tif (b.hasAttribute(atrib[i])) a.setAttribute(atrib[i],b.getAttribute(atrib[i]));\r\n\t};\r\n};\r\nfunction parenosAttr_v_style(ob) {\r\n\tvar atrib=["fill-rule","clip-rule","fill","stroke","stroke-width","stroke-miterlimit","clip-path","fill-opacity","stroke-dasharray","stroke-linecap","dashoffset","stroke-linecap","sroke-linejoin","display","opacity",""];\r\n\tfor (var i=0;i<atrib.length;i++) {\r\n\t\tif (ob.hasAttribute(atrib[i])) {ob.style[atrib[i]]=ob.getAttribute(atrib[i]);ob.removeAttribute(atrib[i]);};\r\n\t};\r\n};\r\n\tfunction zp(el,x,y) {\r\n\t\t\r\n\t\tif (!el.kor) el.kor=[x,y,x,y];\r\n\t\tif (x<el.kor[0]) el.kor[0]=x;\r\n\t\tif (y<el.kor[1]) el.kor[1]=y;\r\n\t\tif (x>el.kor[2]) el.kor[2]=x;\r\n\t\tif (y>el.kor[3]) el.kor[3]=y;\r\n\t\tif (el.parentNode){\r\n\t\t\tif (!el.parentNode.kor) el.parentNode.kor=[x,y,x,y];\r\n\t\t\tif (x<el.parentNode.kor[0]) el.parentNode.kor[0]=x;\r\n\t\t\tif (y<el.parentNode.kor[1]) el.parentNode.kor[1]=y;\r\n\t\t\tif (x>el.parentNode.kor[2]) el.parentNode.kor[2]=x;\r\n\t\t\tif (y>el.parentNode.kor[3]) el.parentNode.kor[3]=y;\r\n\t\t\t\r\n\t\t};\r\n\t};\r\n   var b=ob.getElementsByTagName("glyph");\r\n     for (var t=0;t<b.length;t++){ \r\n\t   b[t].setAttribute("unicode",b[t].getAttribute("unicode").charCodeAt(0));\r\n\t   var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path");\r\n\t    if (b[t].hasAttribute("d")) {c.setAttribute("d",b[t].getAttribute("d"));} else c.setAttribute("d","M0,0 L0,0");\r\n\t\tc.setAttribute("unicode",b[t].getAttribute("unicode"));\r\n\t\tc.setAttribute("horiz-adv-x",b[t].getAttribute("horiz-adv-x"));\r\n\t\tb[t].parentNode.insertBefore(c,b[t]);\r\n\t };\r\n while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("glyph");}\r\n \r\n    var b=ob.getElementsByTagName("defs");\r\n     for (var t=0;t<b.length;t++){ \r\n\t  \r\n\t    var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"g");\r\n\t    c.innerHTML=b[t].innerHTML;\r\n\t   // c.setAttribute("display","none");\r\n\t\tb[t].parentNode.insertBefore(c,b[t]);\r\n\t };\r\n while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("defs");}\r\n \r\n  var b=ob.getElementsByTagName("line");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t var x1=parseFloat(b[t].getAttribute("x1"));\r\n\t\t var y1=parseFloat(b[t].getAttribute("y1"));\r\n\t\t var x2=parseFloat(b[t].getAttribute("x2"));\r\n\t\t var y2=parseFloat(b[t].getAttribute("y2")); \r\n\t\t var t1="M"+" "+x1+","+y1+" "+"L"+" "+x2+","+y2;\r\n\t\t c.setAttribute("d",t1);\r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t b[t].parentNode.insertBefore(c,b[t]);\t \r\n\t };\r\n  while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("line");}\r\n  \r\n  var b=ob.getElementsByTagName("rect");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t var x1=0;\r\n\t\t var y1=0;\r\n\t\t if (b[t].hasAttribute("x")) var x1=parseFloat(b[t].getAttribute("x"));\r\n\t\t if (b[t].hasAttribute("y")) var y1=parseFloat(b[t].getAttribute("y"));\r\n\t\t var x2=x1+parseFloat(b[t].getAttribute("width"));\r\n\t\t var y2=y1+parseFloat(b[t].getAttribute("height")); \r\n\t\t var t1="M"+" "+x1+","+y1+" "+"L"+" "+x2+","+y1+" "+"L"+" "+x2+","+y2+" "+"L"+" "+x1+","+y2+" "+"z";\r\n\t\t if (b[t].hasAttribute("rx")) {\r\n\t\t\t   var rx=parseFloat(b[t].getAttribute("rx"));\r\n\t\t\t   var ry=rx;\r\n\t\t\t   if (b[t].hasAttribute("ry")) ry=parseFloat(b[t].getAttribute("ry"));\r\n\t\t\t   t1="M"+" "+x1+","+(y1+ry)+" "+"S"+" "+(x1)+","+(y1)+" "+(x1+rx)+","+(y1)+"L"+" "+(x2-rx)+","+y1+"S"+" "+(x2)+","+(y1)+" "+(x2)+","+(y1+ry)+"L"+" "+(x2)+","+(y2-ry)+"S"+" "+(x2)+","+(y2)+" "+(x2-rx)+","+(y2)+"L"+" "+(x1+rx)+","+y2+" "+"S"+" "+(x1)+","+(y2)+" "+(x1)+","+(y2-ry)+" "+"z";\r\n\t\t\t };\r\n\t\t c.setAttribute("d",t1);\r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t b[t].parentNode.insertBefore(c,b[t]);\t \r\n\t };\r\n   while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("rect");}\r\n   \r\n   var b=ob.getElementsByTagName("circle");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t var x=parseFloat(b[t].getAttribute("cx"));\r\n\t\t var y=parseFloat(b[t].getAttribute("cy"));\r\n\t\t var rr=parseFloat(b[t].getAttribute("r"));\r\n\t\t var t1="M"+" "+(x-rr)+","+y+"S"+" "+(x-rr)+","+(y-rr)+" "+(x)+","+(y-rr)+"L"+" "+(x)+","+(y-rr)+"S"+" "+(x+rr)+","+(y-rr)+" "+(x+rr)+","+(y)+"L"+" "+(x+rr)+","+(y)+"S"+" "+(x+rr)+","+(y+rr)+" "+(x)+","+(y+rr)+"L"+" "+(x)+","+(y+rr)+"S"+" "+(x-rr)+","+(y+rr)+" "+(x-rr)+","+(y)+"z";\r\n\t\t c.setAttribute("d",t1);\r\n\t\t b[t].parentNode.insertBefore(c,b[t]);\r\n\t    };\r\n   while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("circle");}\r\n\r\n   var b=ob.getElementsByTagName("ellipse");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t var x=parseFloat(b[t].getAttribute("cx"));\r\n\t\t var y=parseFloat(b[t].getAttribute("cy"));\r\n\t\t var rx=parseFloat(b[t].getAttribute("rx"));\r\n\t\t var ry=parseFloat(b[t].getAttribute("ry"));\r\n\t\t var t1="M"+" "+(x-rx).toFixed(3)+","+y.toFixed(3)+" "+"S"+" "+(x-rx).toFixed(3)+","+(y-ry).toFixed(3)+" "+(x).toFixed(3)+","+(y-ry).toFixed(3)+" "+"L"+" "+(x).toFixed(3)+","+(y-ry).toFixed(3)+" "+"S"+" "+(x+rx).toFixed(3)+","+(y-ry).toFixed(3)+" "+(x+rx).toFixed(3)+","+(y).toFixed(3)+" "+"L"+" "+(x+rx).toFixed(3)+","+(y).toFixed(3)+" "+"S"+" "+(x+rx).toFixed(3)+","+(y+ry).toFixed(3)+" "+(x).toFixed(3)+","+(y+ry).toFixed(3)+" "+"L"+" "+(x).toFixed(3)+","+(y+ry).toFixed(3)+" "+"S"+" "+(x-rx).toFixed(3)+","+(y+ry).toFixed(3)+" "+(x-rx).toFixed(3)+","+(y).toFixed(3)+" z";\r\n\t\t //alert(t1);\r\n\t\t c.setAttribute("d",t1);\r\n\t\t b[t].parentNode.insertBefore(c,b[t]);\r\n\t    };\t \r\n\t while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("ellipse");}\r\n\t \r\n\t  var b=ob.getElementsByTagName("polygon");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t if (b[t].id) {\r\n\t\t\t c.id=b[t].id;\r\n\t\t };\r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t var point=b[t].getAttribute("points").split(" ");\r\n\t\t for (var i=0;i<point.length;i++) if (!point[i]) point.splice(i,1);\r\n\t\t for (var i=0;i<point.length;i++) {\r\n\t\t\t zp(c,parseFloat(point[i].split(",")[0]),parseFloat(point[i].split(",")[1]));\r\n\t\t };\r\n\t\t\r\n\t\t point[0]="M "+point[0];\r\n\t\t point[1]="L "+point[1];\r\n\t\t \r\n\t\t point.push("z");\r\n\t\t c.setAttribute("d",point.join(" "));\r\n\t\t  b[t].parentNode.insertBefore(c,b[t]);\r\n\t };\r\n\t  while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("polygon");}\r\n\t  \r\n\t  var b=ob.getElementsByTagName("polyline");\r\n\t for (var t=0;t<b.length;t++){ \r\n\t\t var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n\t\t perenos_atrib(c,b[t]);\r\n\t\t var point=b[t].getAttribute("points").split(" ");\r\n\t\t for (var i=0;i<point.length;i++) if (!point[i]) point.splice(i,1);\r\n\t\t for (var i=0;i<point.length;i++) zp(c,parseFloat(point[i].split(",")[0]),parseFloat(point[i].split(",")[1]));\r\n\t\t point[0]="M "+point[0];\r\n\t\t point[1]="L "+point[1];\r\n\t\t \r\n\t\t c.setAttribute("d",point.join(" "));\r\n\t\t  b[t].parentNode.insertBefore(c,b[t]);\r\n\t };\r\n\t  while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("polyline");}\r\n\t \r\n\t function new_kor(kor,matr) {\r\n\t\t var k=func_proiz_matr([[1,0,0],[0,1,0],[kor[0],kor[1],1]],matr);\r\n\t\t return [k[2][0],k[2][1]];\r\n\t\t \r\n\t };\r\n\t\r\n\t var b=ob.getElementsByTagName("path");\r\n\t for (var t=0;t<b.length;t++){\r\n\t\t \r\n\t//  if (b[t].hasAttribute("onload") && ~b[t].getAttribute("onload").indexOf("this.napravl=true")) b[t].napravl=true;\r\n\t  var c=b[t].getAttribute("d");\r\n\t  var res=[];\r\n\t  var j=0;\r\n\t  res[j]="";\r\n\t  for (var i=0;i<c.length;i++) {\r\n\t\t var r=c[i];\r\n\t\t  if (r=="-") {j++;res[j]=""};\r\n\t\t  if (!parseInt(r) && (r!="0") && (r!=".")  && (r!="-") ) {j++; res[j]=r; j++;res[j]=""} else{\r\n\t\t\t res[j]+=r; \r\n\t\t  };\r\n\t  };\r\n\t  for (i=0;i<res.length;i++) if ((res[i]==",") || (res[i]=="") || (res[i]==" ") || (res[i].charCodeAt(0)==9) || (res[i].charCodeAt(0)==10)) {\r\n\t\t   for (j=i;j<res.length-1;j++) res[j]=res[j+1];\r\n\t\t   res.length--;\r\n\t\t   i--;\r\n\t\t  };\r\n\t  var tek_x=0;\r\n\t  var tek_y=0;\t\r\n\t  if (b[t].napravl) b[t].tohki=[];\r\n      for (i=0;i<res.length;i++) {\r\n\t\t  if (res[i]=="M") {tek_x=parseFloat(res[i+1]);tek_y=parseFloat(res[i+2]);zp(b[t],tek_x,tek_y);};\r\n\t\t  if (res[i]=="m") {tek_x+=parseFloat(res[i+1]);res[i+1]=tek_x;tek_y+=parseFloat(res[i+2]);res[i+2]=tek_y;res[i]="M";zp(b[t],tek_x,tek_y);};\r\n\t\t  if (res[i]=="C") {tek_x=parseFloat(res[i+5]);tek_y=parseFloat(res[i+6]);i=i+6;zp(b[t],tek_x,tek_y);;};\r\n\t\t  if (res[i]=="c") {\r\n\t\t\t   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n\t\t\t   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n\t\t\t   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n\t\t\t   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n\t\t\t   res[i+5]=Math.round((parseFloat(res[i+5])+tek_x)*100)/100;\r\n\t\t\t   res[i+6]=Math.round((parseFloat(res[i+6])+tek_y)*100)/100;\r\n\t\t\t   tek_x=res[i+5];\r\n\t\t\t   tek_y=res[i+6];\r\n\t\t\t   for (var j=0;j<3;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n\t\t\t   res[i]="C";\r\n\t\t\t   i=i+6;\r\n\t\t\t  };\r\n\t\t if (res[i]=="S") {tek_x=parseFloat(res[i+3]);tek_y=parseFloat(res[i+4]);i=i+4;zp(b[t],tek_x,tek_y);;};\r\n\t\t if (res[i]=="Q") {tek_x=parseFloat(res[i+3]);tek_y=parseFloat(res[i+4]);i=i+4;zp(b[t],tek_x,tek_y);;};\t\r\n\t\t if (res[i]=="s") {\r\n\t\t\t   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n\t\t\t   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n\t\t\t   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n\t\t\t   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n\t\t\t   tek_x=res[i+3];\r\n\t\t\t   tek_y=res[i+4];\r\n\t\t\t   for (var j=0;j<2;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n\t\t\t   res[i]="S";\r\n\t\t\t   i=i+4;\r\n\t\t\t  };  \r\n\t\t  if (res[i]=="q") {\r\n\t\t\t   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n\t\t\t   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n\t\t\t   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n\t\t\t   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n\t\t\t   for (var j=0;j<2;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n\t\t\t   tek_x=res[i+3];\r\n\t\t\t   tek_y=res[i+4];\r\n\t\t\t   res[i]="Q";\r\n\t\t\t   i=i+4;\r\n\t\t\t  }; \t  \r\n\t\t\t  \r\n\t\t if (res[i]=="L") {tek_x=Math.round(parseFloat(res[i+1])*100)/100;tek_y=Math.round(parseFloat(res[i+2])*100)/100;i=i+2;zp(b[t],tek_x,tek_y);;};\r\n\r\n\t\t if (res[i]=="l") {\r\n\t\t\t   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n\t\t\t   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n\t\t\t   tek_x=res[i+1];\r\n\t\t\t   tek_y=res[i+2];\r\n\t\t\t   zp(b[t],tek_x,tek_y);\r\n\t\t\t   res[i]="L";\r\n\t\t\t   i=i+2;\r\n\t\t\t  };\r\n\t      if (res[i]=="H") {tek_x=parseFloat(res[i+1]);res[i]="L"; for (var j=res.length;j>i+2;j--) res[j]=res[j-1];res[i+2]=tek_y;};  \r\n\t\t  if (res[i]=="V") {tek_y=parseFloat(res[i+1]);res[i]="L"; for (var j=res.length;j>i+1;j--) res[j]=res[j-1];res[i+1]=tek_x;}; \r\n\t\t  if (res[i]=="h") {tek_x+=parseFloat(res[i+1]);res[i+1]=tek_x;res[i]="L"; for (var j=res.length;j>i+2;j--) res[j]=res[j-1];res[i+2]=tek_y;};\r\n\t\t  if (res[i]=="v") {tek_y+=parseFloat(res[i+1]);res[i+1]=tek_y;res[i]="L"; for (var j=res.length;j>i+1;j--) res[j]=res[j-1];res[i+1]=tek_x;};\r\n\t\t  zp(b[t],tek_x,tek_y);   \r\n        };\t\r\n\t\tvar x=0;\r\n\t\tvar y=0;\r\n\t\tvar step=0;\r\n\t\tif (b[t].napravl) for (i=0;i<res.length;i++) {\r\n\t\t\tif (res[i]=="M") {i++;x=0;y=1;step=1};\r\n\t\t\tif (res[i]=="L") {i++;x=0;y=1;step=1};\r\n\t\t\tif (res[i]=="C") {i++;x=4;y=5;step=5};\r\n\t\t\tif (res[i]=="S" || res[i]=="Q") {i++;x=2;y=3;step=3};\r\n\t\t\tb[t].tohki.push([res[i+x],res[i+y]]);i+=step;\r\n\t\t}\r\n\tvar s="";\r\n\tfor (var i=0;i<res.length;i++) {\r\n\t\tvar e=parseFloat(res[i]);\r\n\t\tif (e) {s+=Math.round(e*100)/100+" "} else s+=res[i]+" ";\r\n\t};\r\n\t\r\n    if (b[t].napravl) {\r\n\t\tfor (var j=0;j<atrib.length;j++) if (b[t].style[atrib[j]]) b[t].style[atrib[j]]="";\r\n\t\tfor (var j=0;j<b[t].tohki.length-1;j++) {\r\n\t\t\tif (j==0) {i=0;} else {i=b[t].tohki[j-1][2]};\r\n\t\t\tvar tt=true;\r\n\t\t\twhile (i<b[t].getTotalLength() && tt) {\r\n\t\t\t\t  if (Math.round(b[t].getPointAtLength(i).x)==Math.round(b[t].tohki[j][0])) {b[t].tohki[j][2]=i;tt=false;}\r\n\t\t\t\t  i++;\r\n\t\t\t};\r\n\t\t};\r\n\t\tb[t].tohki[b[t].tohki.length-1][2]=b[t].getTotalLength();\r\n\t\tfor (var j=1;j<b[t].tohki.length;j++) {\r\n\t\t\tb[t].tohki[j-1][3]=(b[t].tohki[j][2]-b[t].tohki[j-1][2])/(b[t].tohki[j][0]-b[t].tohki[j-1][0]);\r\n\t\t\t//alert(b[t].tohki[j-1][3]+"  "+(b[t].tohki[j][2]));\r\n\t\t\tb[t].tohki[j-1][0]=(b[t].tohki[j-1][0]-b[t].kor[0])/(b[t].kor[2]-b[t].kor[0]);\r\n\t\t\t\r\n\t\t};\r\n\t\tvar ss="";\r\n\t\tfor (var j=0;j<b[t].tohki.length-1;j++) {\r\n\t\t\t\r\n\t\t\tss+=Math.round(b[t].tohki[j][0]*1000)/1000+","+Math.round(b[t].tohki[j][3]*1000)/1000+","+Math.round(b[t].tohki[j][2])+" ";\r\n\t\t};\r\n\t\tif (ss) b[t].setAttribute("date-kof",ss);\r\n\t};\r\n\t\r\n\tb[t].setAttribute("d",s);\r\n\tparenosAttr_v_style(b[t]);\r\n  };\r\n  \r\n  /*var el=ob.getElementsByTagName("path");\r\n  var ud=[];\r\n  \r\n  for (var i=0;i<el.length;i++)  if (el[i].hasAttribute("onload")) {\r\n\t   el[i].vipol=function(){eval (this.getAttribute("onload"))};\r\n\t  el[i].vipol();\r\n\t  if (el[i].sm) {\r\n\t\t // alert(el[i].kor);\r\n\t\t  ud.push(el[i]);\r\n\t\t  var a=func.proiz_matr(func.read_matrix(el[i].parentNode,"transform"),[[1,0,0],[0,1,0],[-el[i].kor[0],-el[i].kor[1],1]]);\r\n\t\t  func.write_matrix(el[i].parentNode,"transform",a);\r\n\t\t  \r\n\r\n\t  };\r\n   };\r\n   for (var i=0;i<ud.length;i++) ud[i].parentNode.removeChild(ud[i]);*/\r\n   \r\n  var el=ob.getElementsByTagName("g"); for (var j=0;j<el.length;j++) el[j].kor="";\r\n  \r\n  var gr=[];\r\n  \r\n  var el=ob.getElementsByTagName("radialGradient");\r\n  for (var i=0;i<el.length;i++) gr.push(el[i]);\r\n  /*var el=ob.getElementsByTagName("linearGradient");\r\n  for (var i=0;i<el.length;i++) gr.push(el[i]);*/\r\n  for (var i=0;i<gr.length;i++) {\r\n\t  var a=[[1,0,0],[0,1,0],[0,0,1]];\r\n\t  ee=gr[i].parentNode;\r\n\t  while (ee)  {\r\n\t\t   a=func_proiz_matr(a,read_matrix(ee,"transform"));\r\n\t       ee=ee.parentNode;\r\n\t  };\r\n\t// func.write_matrix(gr[i],"transform",a);\r\n\t // gr[i].setAttribute("cx",parseFloat(gr[i].getAttribute("cx"))+a[2][0]);\r\n     // gr[i].setAttribute("cy",parseFloat(gr[i].getAttribute("cy"))-a[2][1]);\r\n  };\r\n  var el=ob.getElementsByTagName("path");\r\n\r\n            \r\n\t\t\t\t\r\n  for (var i=0;i<el.length;i++) {\r\n\t  \r\n\t  el[i].kor="";\r\n\t  var a=[[1,0,0],[0,1,0],[0,0,1]];\r\n\t  var ee=el[i];\r\n\t\r\n\t  while (ee)  {\r\n\t\t   var a=func_proiz_matr(a,read_matrix(ee,"transform"));\r\n\t\t    \r\n\t       ee=ee.parentNode;\r\n\t\t   \t \r\n\t  };\r\n\r\n\t  \r\n\t  var ar=el[i].getAttribute("d").split(/[ ,]/);\r\n\t  var s="";\r\n\t  for (var j=0;j<ar.length;j++) if (~ar[j].search(/[A-Zz]/) || !ar[j]) {s+=ar[j]+" "} else {\r\n\t\t  var x=parseFloat(ar[j]);\r\n\t\t  j++;\r\n\t\t  var y=parseFloat(ar[j]);\r\n\t\t  var kr=func_proiz_matr([[1,0,0],[0,1,0],[x,y,1]],a);\r\n\t\t  s+=kr[2][0]+","+kr[2][1]+" ";\r\n\t\t  zp(el[i],kr[2][0],kr[2][1]);\r\n\t  };\r\n\t  el[i].setAttribute("d",s);\r\n  };\r\n  var el=ob.getElementsByTagName("g");\r\n\tfor (var j=0;j<el.length;j++) {\r\n\t\t write_matrix(el[j],[[1,0,0],[0,1,0],[0,0,1]]);\r\n\t\t for (var i=0;i<el.length;i++) if (el[i].kor) { \r\n\t        zp(el[i].parentNode,el[i].kor[0],el[i].kor[1]);\r\n\t\t    zp(el[i].parentNode,el[i].kor[2],el[i].kor[3]);\r\n\t\t };\r\n\t\t\r\n\t};\r\n  var el=ob.getElementsByTagName("g");\r\n  for (var i=0;i<el.length;i++) {\r\n\t  if (el[i].hasAttribute("transform")) el[i].removeAttribute("transform")\r\n\t  el[i].setAttribute("kor",el[i].kor);\r\n\t  /* if (el[i].hasAttribute("onload")) {\r\n\t\t\tel[i].vipol=function(){eval (this.getAttribute("onload"))};\r\n\t\t\tel[i].vipol();\r\n\t\t  //el[i].setAttribute("vipol",el[i].getAttribute("onload"));\r\n\t\t  el[i].removeAttribute("onload")\r\n\t\t  \r\n\t\t}; */\r\n\t  if (el[i].id) el[i].removeAttribute("id");\r\n  };\r\n  var el=ob.getElementsByTagName("g");\r\n  var ud=[];\r\n  \r\n  \r\n   for (var i=0;i<ud.length;i++) ud[i].parentNode.removeChild(ud[i]);\r\n   \r\n  var el=ob.getElementsByTagName("path");\r\n   for (var i=0;i<el.length;i++) {\r\n\t  el[i].setAttribute("kor",el[i].kor);\r\n\t  if (el[i].style["stroke-miterlimit"]) el[i].style["stroke-miterlimit"]="";\r\n\t  if (el[i].style["fill"]=="none" && (!el[i].parentNode.style["fill"] || el[i].parentNode.style["fill"]=="none")) {\r\n\t\t  el[i].style["fill"]="";\r\n\t\t  el[i].parentNode.style["fill"]="none";\r\n\t\t\r\n\t  };\r\n\t  //if (el[i].hasAttribute("onload")) {el[i].setAttribute("vipol",el[i].getAttribute("onload"));el[i].removeAttribute("onload")};\r\n\t   \r\n  };\r\n  \r\n  return ob;\r\n};\r\nfunction func_proiz_matr(matr_a,matr_b){\r\n    if (matr_a.length==3) {var c=[[0,0,0],[0,0,0],[0,0,0]]} else var c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];\r\n    for (var k=0;k<matr_b.length;k++)  for (var j=0;j<matr_b[0].length;j++)  for (var i=0;i<matr_a[0].length;i++) c[j][k]+=matr_a[j][i]*matr_b[i][k];\r\n    return c;\r\n  };\r\n  function write_matrix(el,a) { \r\n    var type="transform";\r\n    for (var i=0;i<a.length;i++) for (var j=0;j<a[i].length;j++) if (a[i][j]!=parseFloat(a[i][j])) console.log(\'Ошибка записи простой матрицы \'+a);\r\n    var s="matrix("+a[0][0]+","+a[0][1]+","+a[1][0]+","+a[1][1]+","+a[2][0]+","+a[2][1]+")";\r\n    el.setAttribute(type,s);;\r\n    \r\n};\r\n  function read_matrix(el){\r\n    var type="transform";\r\n    var mt="";\r\n    try {\r\n        if (el && el.hasAttribute(type))  mt=el.getAttribute(type);\r\n        if (el.style && el.style[type]) mt=el.style[type];\r\n    } catch (e) {};\r\n    if (!mt) {var s=[[1,0,0],[0,1,0],[0,0,1]];el.beg_mt=s;return s};\r\n    var r=mt.split("(")[1];\r\n    if (~r.indexOf(",")) {r=r.split(",")} else r=r.split(" ");\r\n    for (var i=0;i<r.length;i++) r[i]=parseFloat(r[i]);\r\n    var s=[[r[0],r[1],0],[r[2],r[3],0],[r[4],r[5],1]];\r\n    if (!el.beg_mt) el.beg_mt=s;\r\n    return s;\r\n};\r\nfunction ajax(ur,fn){\r\n    function getXmlHttp(){\r\n      var xmlhttp;\r\n      try {\r\n        xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");\r\n      } catch (e) {\r\n        try {\r\n          xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");\r\n        } catch (E) {\r\n          xmlhttp = false;\r\n        }\r\n      }\r\n      if (!xmlhttp && typeof XMLHttpRequest!="undefined") {\r\n        xmlhttp = new XMLHttpRequest();\r\n      }\r\n      return xmlhttp;\r\n    };\r\n    var xhr = new getXmlHttp();\r\n    xhr.open("GET", ur, true);\r\n    xhr.fn=fn;\r\n    xhr.onreadystatechange = function() { \r\n      if (xhr.readyState != 4) return; \r\n      if (xhr.responseText && xhr.responseText!=undefined) {\r\n          var tt=xhr.responseText;\r\n          this.fn(tt);\r\n      } ;\r\n    };\r\n    xhr.send();\r\n};\r\nfunction svg_scale(ob){\r\n    var StapWheel=0.1;\r\n    var minScale=.1;\r\n    var maxScale=1;\r\n    document.addEventListener(\'mouseup\',onPointerUp, false);\r\n    document.addEventListener( "touchend", onPointerUp, false );\r\n    document.addEventListener( "touchcancel", onPointerUp, false );\r\n    document.addEventListener( "touchleave", onPointerUp, false );\r\n    document.addEventListener(\'mousemove\',onPointerHover,false);\r\n\tdocument.addEventListener( "touchmove", onPointerHover, false );\r\n\t//ob.addEventListener(\'mouseout\',onPointerUp,false);\r\n    function onPointerHover(event){\r\n        if (window.kr_zj && window.kr_zj.kr) {\r\n            if (event.touches) {\r\n                    var point_=[event.touches[0].pageX,event.touches[0].pageY];\r\n                    if (event.touches.length>1) {\r\n                        var len_sc=Math.sqrt(Math.pow(event.touches[1].pageX-event.touches[0].pageX,2)+Math.pow(event.touches[1].pageY-event.touches[0].pageY,2));\r\n                        var ot=window.kr_zj.ob.len_sc/len_sc;\r\n                        window.kr_zj.ob.len_sc=len_sc;\r\n                        window.kr_zj.ob.tek_zn*=ot;\r\n                        window.kr_zj.ob.scale();\r\n                    };\r\n                } else var point_=[event.pageX,event.pageY];\r\n            if (!window.kr_zj.ob.shipok) {window.kr_zj.ob.sm=[point_[0]-window.kr_zj.kr[0],point_[1]-window.kr_zj.kr[1]];\r\n            window.kr_zj.ob.scale();}\r\n        }\r\n    };\r\n    function onPointerUp(event){\r\n        if (event.touches && event.touches.length==0) window.kr_zj.ob.shipok=false;\r\n        if (window.kr_zj && window.kr_zj.kr) window.kr_zj.kr=\'\';\r\n        \r\n    };\r\n        if (ob && ob.hasAttribute(\'viewBox\')){\r\n            ob.beg_view=ob.getAttribute("viewBox").split(" ");\r\n            if (ob.addEventListener) {\r\n                if (\'onwheel\' in document) {\r\n                ob.addEventListener("wheel", onWheel);\r\n                } else if (\'onmousewheel\' in document) {\r\n                ob.addEventListener("mousewheel", onWheel);\r\n                } else {\r\n                ob.addEventListener("MozMousePixelScroll", onWheel);\r\n                }\r\n            } else { \r\n                ob.attachEvent("onmousewheel", onWheel);\r\n            };\r\n            function onWheel(e) {\r\n                e = e || window.event;\r\n                var delta = e.deltaY || e.detail || e.wheelDelta;\r\n                delta=delta/Math.abs(delta);\r\n                this.tek_zn+=delta*StapWheel;\r\n                this.scale();\r\n                e.preventDefault ? e.preventDefault() : (e.returnValue = false);\r\n            };\r\n            ob.tek_zn=1;\r\n            ob.sm=[0,0];\r\n            ob.sm_zj=[0,0];\r\n            ob.tek_sm=[0,0];\r\n\t\t\tob.shipok=false;\r\n\t\t\t\r\n            ob.scale=function(){\r\n                 if (this.tek_zn>maxScale) {\r\n                    this.tek_zn=maxScale;\r\n                    this.tek_sm=[0,0];\r\n                    this.sm_zj=[0,0];\r\n                    this.sm=[0,0];\r\n                }\r\n                if (this.tek_zn<minScale) this.tek_zn=minScale;\r\n                /*var pos=[];\r\n                for (var i=0;i<this.beg_view.length;i++) pos[i]=this.beg_view[i];\r\n                if (!this.shipok) this.tek_sm=[this.sm[0]+this.sm_zj[0],this.sm[1]+this.sm_zj[1]];\r\n                var ps=[pos[2]-pos[2]*this.tek_zn,pos[3]-pos[3]*this.tek_zn];\r\n                if (this.tek_sm[1]*this.tek_zn>ps[1]/2) this.tek_sm[1]=ps[1]/2/this.tek_zn;\r\n                if (this.tek_sm[1]*this.tek_zn<-ps[1]/2) this.tek_sm[1]=-ps[1]/2/this.tek_zn;\r\n                if (this.tek_sm[0]*this.tek_zn>ps[0]/2) this.tek_sm[0]=ps[0]/2/this.tek_zn;\r\n                if (this.tek_sm[0]*this.tek_zn<-ps[0]/2) this.tek_sm[0]=-ps[0]/2/this.tek_zn;\r\n                pos[0]=parseFloat(pos[0])+(ps[0])/2-(this.tek_sm[0])*this.tek_zn;\r\n                pos[1]=parseFloat(pos[1])+(ps[1])/2-(this.tek_sm[1])*this.tek_zn;\r\n                pos[2]*=this.tek_zn;\r\n                pos[3]*=this.tek_zn;\r\n\t\t\t\tthis.setAttribute("viewBox",pos.join(" ")); */\r\n\t\t\t\tthis.wh=[parseFloat(this.beg_view[2]),parseFloat(this.beg_view[3])];\r\n\t\t\t\tthis.kf=parseFloat(this.beg_view[2])/this.clientWidth;\r\n\t\t\t\tvar ps=[this.wh[0]-this.wh[0]*this.tek_zn,this.wh[1]-this.wh[1]*this.tek_zn];\r\n\t\t\t\tif (!this.shipok) this.tek_sm=[(this.sm[0]+this.sm_zj[0]),this.sm[1]+this.sm_zj[1]];\r\n\t\t\t\tif (this.tek_sm[1]*this.tek_zn>ps[1]/2) this.tek_sm[1]=ps[1]/2/this.tek_zn;\r\n                if (this.tek_sm[1]*this.tek_zn<-ps[1]/2) this.tek_sm[1]=-ps[1]/2/this.tek_zn;\r\n                if (this.tek_sm[0]*this.tek_zn>ps[0]/2) this.tek_sm[0]=ps[0]/2/this.tek_zn;\r\n                if (this.tek_sm[0]*this.tek_zn<-ps[0]/2) this.tek_sm[0]=-ps[0]/2/this.tek_zn;\r\n\t\t\t\tvar mt=[[1,0,0],[0,1,0],[0,0,1]];\r\n\t\t\t\t\r\n\t\t\t\tmt=func_proiz_matr(mt,[[1,0,0],[0,1,0],[-this.wh[0]/2+this.tek_sm[0]*this.tek_zn,-this.wh[1]/2+this.tek_sm[1]*this.tek_zn,1]]);\r\n\t\t\t\tmt=func_proiz_matr(mt,[[1/this.tek_zn,0,0],[0,1/this.tek_zn,0],[0,0,1]]);\r\n\t\t\t\tmt=func_proiz_matr(mt,[[1,0,0],[0,1,0],[this.wh[0]/2,this.wh[1]/2,1]]);\r\n\t\t\t\twrite_matrix(this.children[0],mt);\r\n\t\t\t\tthis.mt=mt;\r\n\t\t\t};\r\n\t\t\tob.scale();\r\n            ob.addEventListener(\'mousedown\',onPointerDown,false);\r\n            ob.addEventListener( "touchstart", onPointerDown, false );\r\n            function onPointerDown( event ) {\r\n\t\t\t\t//\r\n                if (event.touches) {\r\n                    var point_=[event.touches[0].pageX,event.touches[0].pageY];\r\n                    if (event.touches.length>1) {\r\n                        this.len_sc=Math.sqrt(Math.pow(event.touches[1].pageX-event.touches[0].pageX,2)+Math.pow(event.touches[1].pageY-event.touches[0].pageY,2));\r\n                        this.shipok=true;\r\n                    };\r\n                } else var point_=[event.pageX,event.pageY];\r\n                if (!this.shipok) {\r\n\t\t\t\t\twindow.kr_zj={kr:[point_[0],point_[1]],ob:this};\r\n\t\t\t\t\twindow.kr_zj.ob.sm=[0,0];\r\n                    this.sm_zj=[this.tek_sm[0],this.tek_sm[1]];\r\n                };\r\n                event.preventDefault();event.stopPropagation();return false;\r\n            };\r\n        };\r\n\r\n};\r\nfunction InverseMatrix(mt) {  // Обратная матрица\r\n\tvar A = [[],[],[]];\r\n\tfor (var i=0;i<3;i++) for (var j=0;j<3;j++) A[i][j] = mt[i*3+j];\r\n\tfunction Determinant(A) {  // Определитель матрицы (используется алгоритм Барейса)\r\n\r\n\t\tvar N = A.length, B = [], denom = 1, exchanges = 0;\r\n\t\tfor (var i = 0; i < N; ++i)\r\n\t\t { B[i] = [];\r\n\t\t   for (var j = 0; j < N; ++j) B[i][j] = A[i][j];\r\n\t\t }\r\n\t\tfor (var i = 0; i < N-1; ++i)\r\n\t\t { var maxN = i, maxValue = Math.abs(B[i][i]);\r\n\t\t   for (var j = i+1; j < N; ++j)\r\n\t\t\t{ var value = Math.abs(B[j][i]);\r\n\t\t\t  if (value > maxValue){ maxN = j; maxValue = value; }\r\n\t\t\t}\r\n\t\t   if (maxN > i)\r\n\t\t\t{ var t = B[i]; B[i] = B[maxN]; B[maxN] = t;\r\n\t\t\t  ++exchanges;\r\n\t\t\t}\r\n\t\t   else { if (maxValue == 0) return maxValue; }\r\n\t\t   var value1 = B[i][i];\r\n\t\t   for (var j = i+1; j < N; ++j)\r\n\t\t\t{ var value2 = B[j][i];\r\n\t\t\t  B[j][i] = 0;\r\n\t\t\t  for (var k = i+1; k < N; ++k) B[j][k] = (B[j][k]*value1-B[i][k]*value2)/denom;\r\n\t\t\t}\r\n\t\t   denom = value1;\r\n\t\t }                                           //@ http://mathhelpplanet.com/viewtopic.php?f=44&t=22390\r\n\t\tif (exchanges%2) return -B[N-1][N-1];\r\n\t\telse return B[N-1][N-1];\r\n\t};\r\n\tvar det = Determinant(A);\r\n\tif (det == 0) return false;\r\n\tvar N = A.length, invA = [];\r\n\tfor (var i = 0; i < N; i++)\r\n\t { invA[i] = [];\r\n\t   for (var j = 0; j < N; j++)\r\n\t\t{ var B = [], sign = ((i+j)%2==0) ? 1 : -1;\r\n\t\t  for (var m = 0; m < j; m++)\r\n\t\t   { B[m] = [];\r\n\t\t\t for (var n = 0; n < i; n++)   B[m][n] = A[m][n];\r\n\t\t\t for (var n = i+1; n < N; n++) B[m][n-1] = A[m][n];\r\n\t\t   }\r\n\t\t  for (var m = j+1; m < N; m++)\r\n\t\t   { B[m-1] = [];\r\n\t\t\t for (var n = 0; n < i; n++)   B[m-1][n] = A[m][n];\r\n\t\t\t for (var n = i+1; n < N; n++) B[m-1][n-1] = A[m][n];\r\n\t\t   }\r\n\t\t  invA[i][j] = sign*Determinant(B)/det;\r\n\t\t}\r\n\t };\r\n\t\r\n\treturn invA;\r\n};\r\nfunction readCord(el) {\r\n\tvar k=el.getAttribute("kor").split(",");\r\n\tfor (var i=0;i<k.length;i++) k[i]=parseFloat(k[i]);\r\n\tk.push(k[0]+(k[2]-k[0])/2);\r\n\tk.push(k[1]+(k[3]-k[1])/2);\r\n\treturn k;\r\n};\r\nvar lineSegmentsIntersect = (l1,l2)=> {\r\n    //console.log(\'22\',l1,l2);\r\n    //x1, y1, x2, y2, x3, y3, x4, y4\r\n    var x1=l1[0][0];var x2=l1[1][0];var y1=l1[0][1];var y2=l1[1][1];\r\n    var x3=l2[0][0];var x4=l2[1][0];var y3=l2[0][1];var y4=l2[1][1];\r\n\r\n    var a_dx = x2 - x1;\r\n    var a_dy = y2 - y1;\r\n    var b_dx = x4 - x3;\r\n    var b_dy = y4 - y3;\r\n     var s = (-a_dy * (x1 - x3) + a_dx * (y1 - y3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    var t = (+b_dx * (y1 - y3) - b_dy * (x1 - x3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    return (s >= 0 && s <= 1 && t >= 0 && t <= 1) ? [x1 + t * a_dx, y1 + t * a_dy] : false;\r\n};\r\nfunction rotX(arg){\r\n\tvar cs=Math.cos(arg);\r\n\tvar sn=Math.sin(arg);\r\n\treturn [[cs,sn,0],[-sn,cs,0],[0,0,1]];\r\n};\r\n\n;// CONCATENATED MODULE: ./modul_shapes/src/class.ts\nvar __extends = (undefined && undefined.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== "function" && b !== null)\r\n            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __assign = (undefined && undefined.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\n\r\nvar fnMove = {\r\n    el: {},\r\n    fnMove: function (cord) { },\r\n    fnUp: function (cord) { },\r\n    cordOneClick: [0, 0],\r\n    boolUp: false\r\n};\r\ndocument.addEventListener(\'mousemove\', onPointerHover, false);\r\ndocument.addEventListener("touchmove", onPointerHover, false);\r\ndocument.addEventListener(\'mouseup\', onPointerUp, false);\r\ndocument.addEventListener("touchend", onPointerUp, false);\r\ndocument.addEventListener("touchcancel", onPointerUp, false);\r\ndocument.addEventListener("touchleave", onPointerUp, false);\r\ndocument.addEventListener(\'contextmenu\', function (event) { event.preventDefault(); return false; }, false);\r\n//\r\n//setTimeout(()=>,20);\\\r\nvar fnScroll = {};\r\nvar curentAsspectScroll = 1;\r\nfunction onPointerHover(e) {\r\n    var dataCord = converCord(e);\r\n    //console.log(dataCord);\r\n    if (dataCord.twoTouch) {\r\n        //dataCord.len_point/fnMove["beginLen"]\r\n        var aspect = dataCord.len_point / fnMove["beginLen"];\r\n        //document.getElementById("info").innerHTML=aspect+"";\r\n        var defAspect = aspect - curentAsspectScroll;\r\n        curentAsspectScroll = aspect;\r\n        if (fnScroll[\'el\'])\r\n            fnScroll[\'fn\'].call(fnScroll[\'el\'], -defAspect);\r\n    }\r\n    else if (fnMove.boolUp) {\r\n        fnMove.fnMove.call(fnMove.el, dataCord);\r\n        // document.getElementById("info").innerHTML="11"\r\n    }\r\n}\r\n;\r\nvar arFunctionUp = [];\r\nfunction setUpFunction(fn) {\r\n    arFunctionUp.push(fn);\r\n}\r\n;\r\nfunction onPointerUp(e) {\r\n    fnMove.fnUp.call(fnMove.el, converCord(e));\r\n    fnMove = {\r\n        el: {},\r\n        fnMove: function (cord) { },\r\n        fnUp: function (cord) { },\r\n        cordOneClick: [0, 0],\r\n        boolUp: false\r\n    };\r\n    for (var _i = 0, arFunctionUp_1 = arFunctionUp; _i < arFunctionUp_1.length; _i++) {\r\n        var k = arFunctionUp_1[_i];\r\n        k();\r\n    }\r\n    // console.log(resetVirtualMenu);\r\n}\r\nvar LayBegin = /** @class */ (function () {\r\n    function LayBegin(par) {\r\n        this.parent = {};\r\n        this.name = "";\r\n        this.children = [];\r\n        this.child_name = {};\r\n        this.childLast = {};\r\n        this.eventList = {};\r\n        this.parN = function (n) {\r\n            var r = this.parent;\r\n            for (var i = 0; i < n - 1; i++)\r\n                r = r.parent;\r\n            return r;\r\n        };\r\n        this.addEvent = function (event, ob, fn) {\r\n            if (!this.eventList[event])\r\n                this.eventList[event] = [];\r\n            this.eventList[event].push({ ob: ob, funct: fn });\r\n        };\r\n        this.runEvent = function (event, arg) {\r\n            if (this.eventList[event])\r\n                for (var i = 0; i < this.eventList[event].length; i++)\r\n                    this.eventList[event][i].funct.call(this.eventList[event][i].ob, arg);\r\n        };\r\n        this.removeEvent = function (event, ob) {\r\n            if (this.eventList[event])\r\n                for (var i = 0; i < this.eventList[event].length; i++)\r\n                    if (this.eventList[event][i].ob === ob) {\r\n                        this.eventList[event].splice(i, 1);\r\n                    }\r\n        };\r\n        this.childAr = function (ar) {\r\n            var el = this;\r\n            for (var i = 0; i < ar.length; i++)\r\n                el = el.child_name[ar[i]];\r\n            return el;\r\n        };\r\n        var txis = this;\r\n        function add(el, parent, insert) {\r\n            if (parent.children.length > 0)\r\n                el.childLast = parent.children[parent.children.length - 1];\r\n            if (insert) {\r\n                var nb = 0;\r\n                for (var i = 0; i < parent.children.length; i++)\r\n                    if (insert === parent.children[i])\r\n                        nb = i;\r\n                parent.children.splice(nb, 0, el);\r\n            }\r\n            else {\r\n                parent.children.push(el);\r\n            }\r\n            ;\r\n            el.parent = parent;\r\n            if (par[\'children\'])\r\n                add_name(el, parent);\r\n        }\r\n        ;\r\n        function add_name(el, parent) {\r\n            if (par[\'name\'] && !el.name)\r\n                el.name = par[\'name\'];\r\n            if (!el.name)\r\n                el.name = el.constructor[\'name\'];\r\n            if (parent) {\r\n                var nn = el.name;\r\n                var i = 0;\r\n                while (parent.child_name[nn]) {\r\n                    i += 1;\r\n                    nn = el.name + "_" + (i);\r\n                }\r\n                ;\r\n                el.name = nn;\r\n                //\r\n                el.curentIndex = parent.children.length;\r\n                parent.child_name[nn] = el;\r\n                //parent.children.push(el);\r\n                el.parent = parent;\r\n            }\r\n        }\r\n        ;\r\n        this[\'add\'] = function (el) {\r\n            if (!el.name)\r\n                el.name = el.constructor[\'name\'];\r\n            add_name(el, this);\r\n            add(el, txis, false);\r\n            //console.log(par[\'name\'],el.name);\r\n            el.html[\'setAttribute\']("data-name", el.name);\r\n            this.html.appendChild(el.html);\r\n        };\r\n        var install_par = {\r\n            \'name\': function (name) {\r\n                // txis.name=name;\r\n                // add_name(txis,par[\'parent\']);\r\n                /* txis.name=name;\r\n                if (par[\'parent\']) {\r\n                    var nn=name;\r\n                    var i=0;\r\n                    while (par[\'parent\'].child_name[nn]) {\r\n                        i+=1;\r\n                        nn=name+"_"+(i);\r\n                    };\r\n                    par[\'parent\'].child_name[nn]=txis;\r\n                } */\r\n            },\r\n            \'parent\': function (parent) {\r\n                //txis.name=par[\'name\'];\r\n                add_name(txis, par[\'parent\']);\r\n                add(txis, parent, par[\'insert\']);\r\n                //txis[\'html\'][\'setAttribute\']("data-name",txis.name);\r\n                /* if (parent.children.length>0) txis.childLast=parent.children[parent.children.length-1];\r\n                if (par[\'insert\']) {\r\n                    var nb=0;\r\n                    for (var i=0;i<parent.children.length;i++) if (par[\'insert\']===parent.children[i]) nb=i;\r\n                    parent.children.splice(nb,0,txis);\r\n                } else parent.children.push(txis);\r\n                txis.parent=parent; */\r\n            },\r\n            children: function (ch) {\r\n                for (var i = 0; i < ch.length; i++)\r\n                    add(par[\'layer\'][ch[i]], txis, false);\r\n            },\r\n            /* childrenElem:function(ch){\r\n                for (var i=0;i<ch.length;i++) {\r\n                    console.log({... ch[i]},txis)\r\n                    add(ch[i],txis,false);\r\n                };\r\n            } ,*/\r\n        };\r\n        if (!par[\'name\']) {\r\n            par[\'name\'] = this.constructor[\'name\'];\r\n        }\r\n        else\r\n            this.name = par[\'name\'];\r\n        for (var k in par)\r\n            if (install_par[k])\r\n                install_par[k](par[k]);\r\n    }\r\n    LayBegin.prototype.clone = function () { };\r\n    ;\r\n    LayBegin.prototype.remove = function () {\r\n        //for (var k in event) if (event[k].el===this)\r\n        for (var i = 0; i < this.parent[\'children\'].length; i++)\r\n            if (this.parent[\'children\'][i] === this)\r\n                this.parent[\'children\'].splice(i, 1);\r\n        for (var k in this.parent[\'child_name\'])\r\n            if (this.parent[\'child_name\'][k] === this)\r\n                delete this.parent[\'child_name\'][k];\r\n        if (this.parent[\'children\'][0])\r\n            this.parent[\'children\'][0].childLast = {};\r\n        for (var i = 1; i < this.parent[\'children\'].length; i++)\r\n            this.parent[\'children\'][i].childLast = this.parent[\'children\'][i - 1];\r\n        while (this[\'html\'].parentNode)\r\n            this[\'html\'].parentNode.removeChild(this[\'html\']);\r\n        for (var i = 0; i < this.parent[\'children\'].length; i++)\r\n            this.parent[\'children\'][i].curentIndex = i;\r\n        // console.log(this[\'html\'].parentNode);\r\n    };\r\n    ;\r\n    ;\r\n    return LayBegin;\r\n}());\r\n;\r\nvar LayGroup = /** @class */ (function (_super) {\r\n    __extends(LayGroup, _super);\r\n    function LayGroup(par) {\r\n        return _super.call(this, par) || this;\r\n    }\r\n    return LayGroup;\r\n}(LayBegin));\r\n;\r\nvar LayGroupHTML = /** @class */ (function (_super) {\r\n    __extends(LayGroupHTML, _super);\r\n    function LayGroupHTML(par) {\r\n        var _this_1 = _super.call(this, par) || this;\r\n        _this_1.setPosition = function (par) {\r\n            for (var k in par)\r\n                this.current_position[k] = par[k];\r\n            var sst = [\'left\', \'top\', \'width\', \'height\'];\r\n            for (var k in sst)\r\n                if (this.current_position[sst[k]] != undefined) {\r\n                    this.html.style[sst[k]] = this.current_position[sst[k]] + "px";\r\n                    //console.log(this.current_position[sst[k]]);\r\n                }\r\n            this.current_position[\'heightTop\'] = 0;\r\n            this.current_position[\'widthLeft\'] = 0;\r\n            if (this.current_position[\'top\'] != undefined && this.current_position[\'height\'] != undefined)\r\n                this.current_position[\'heightTop\'] = this.current_position[\'top\'] + this.current_position[\'height\'];\r\n            if (this.current_position[\'left\'] != undefined && this.current_position[\'width\'] != undefined)\r\n                this.current_position[\'widthLeft\'] = this.current_position[\'left\'] + this.current_position[\'width\'];\r\n        };\r\n        _this_1.html = document.createElement("div");\r\n        _this_1.resize = function () {\r\n            var dv = this.html[\'children\'];\r\n            for (var i = 0; i < dv.length; i++)\r\n                if (dv[i][\'ob_strukt\'] && dv[i][\'ob_strukt\'].resize)\r\n                    dv[i][\'ob_strukt\'].resize();\r\n        };\r\n        /*  svgLoad=function(){\r\n             console.log(33);\r\n         }; */\r\n        _this_1.current_position = { width: undefined, height: undefined, left: undefined, top: undefined };\r\n        _this_1.wh_parent = [];\r\n        if (par[\'elementInsert\']) {\r\n            _this_1.html = par[\'elementInsert\'].cloneNode(true);\r\n        }\r\n        else if (par[\'svg\'] && par[\'tag\']) {\r\n            _this_1.html = document.createElementNS("http://www.w3.org/2000/svg", par[\'tag\']);\r\n        }\r\n        else if (par[\'tag\']) {\r\n            _this_1.html = document.createElement(par[\'tag\']);\r\n            if (par[\'tag\'] == "svg")\r\n                _this_1.html = document.createElementNS("http://www.w3.org/2000/svg", par[\'tag\']);\r\n        }\r\n        else if (par[\'svg\'] && !par[\'tag\']) {\r\n            _this_1.html = document.createElementNS("http://www.w3.org/2000/svg", par[\'svg\']);\r\n        }\r\n        _this_1.html["ob_strukt"] = _this_1;\r\n        if ((!par[\'style\'] || par[\'style\'][\'position\'] != "") && !par[\'svg\'])\r\n            _this_1.html[\'style\'].position = "absolute";\r\n        var txis = _this_1;\r\n        var install_par = {\r\n            /* \'name\':function(name){\r\n                txis.html[\'setAttribute\']("data-name",name);\r\n            }, */\r\n            \'el_parent\': function (el_parent) {\r\n                el_parent.appendChild(txis.html);\r\n            },\r\n            \'parent\': function (parent) {\r\n                if (parent[\'html\'] && !par[\'el_parent\'])\r\n                    if (par[\'insert\']) {\r\n                        parent[\'html\'].insertBefore(txis.html, par[\'insert\'].html);\r\n                    }\r\n                    else\r\n                        parent[\'html\'].appendChild(txis.html);\r\n            },\r\n            \'style\': function (atr) {\r\n                for (var k in atr)\r\n                    txis.html["style"][k] = atr[k];\r\n            },\r\n            \'attribute\': function (atr) {\r\n                for (var k in atr)\r\n                    txis.html["setAttribute"]([k], atr[k]);\r\n            },\r\n            \'valueResize\': function (par) {\r\n                txis[\'valueResize\'] = par;\r\n            },\r\n            \'resize\': function (fn_res) {\r\n                txis[\'resize\'] = function () {\r\n                    if (txis.parent[\'html\'])\r\n                        txis[\'wh_parent\'] = [txis.parent[\'html\'].offsetWidth, txis.parent[\'html\'].offsetHeight];\r\n                    fn_res.call(txis);\r\n                    var dv = txis.html[\'children\'];\r\n                    for (var i = 0; i < dv.length; i++)\r\n                        if (dv[i][\'ob_strukt\'] && dv[i][\'ob_strukt\'].resize)\r\n                            dv[i][\'ob_strukt\'].resize();\r\n                };\r\n            },\r\n            \'children\': function (ch) {\r\n                for (var i = 0; i < ch.length; i++)\r\n                    txis.html[\'appendChild\'](par[\'layer\'][ch[i]].html);\r\n            },\r\n            "innerHTML": function (a) {\r\n                txis.html[\'innerHTML\'] = a;\r\n            },\r\n            appendChild: function (el) {\r\n                txis.html[\'appendChild\'](el);\r\n            },\r\n            childrenElem: function (ch) {\r\n                //console.log({... this})\r\n                //;\r\n                for (var i = 0; i < ch.length; i++) {\r\n                    //console.log({... ch[i]},txis) \r\n                    this.add(ch[i], txis);\r\n                }\r\n                ;\r\n            },\r\n            down: function (objFn) {\r\n                this.html.addEventListener("mousedown", dw);\r\n                this.html.addEventListener("touchstart", dw);\r\n                function dw(event) {\r\n                    var cordObj = converCord(event);\r\n                    if (!cordObj.twoTouch) {\r\n                        fnMove.cordOneClick = cordObj.cord.slice();\r\n                    }\r\n                    else {\r\n                        curentAsspectScroll = 1;\r\n                        fnMove[\'beginLen\'] = cordObj.len_point;\r\n                    }\r\n                    if (objFn.fnDown)\r\n                        objFn.fnDown.call(txis, cordObj);\r\n                    if (objFn.fnMove) {\r\n                        fnMove.fnMove = objFn.fnMove;\r\n                        fnMove.boolUp = true;\r\n                        fnMove.el = txis;\r\n                    }\r\n                    ;\r\n                    if (objFn.fnUp) {\r\n                        fnMove.fnUp = objFn.fnUp;\r\n                        fnMove.el = txis;\r\n                    }\r\n                    ;\r\n                    //event.preventDefault ? event.preventDefault() : (event.returnValue = false);\r\n                    // event.preventDefault();event.stopPropagation();return false;\r\n                }\r\n            },\r\n            input: function (fn) {\r\n                this.html.addEventListener("input", fn);\r\n            },\r\n            click: function (fn) {\r\n                this.html.addEventListener("click", fn);\r\n            },\r\n            scroll: function (fn) {\r\n                var ob = txis.html;\r\n                if (ob[\'addEventListener\']) {\r\n                    if (\'onwheel\' in document) {\r\n                        // IE9+, FF17+, Ch31+\r\n                        ob[\'addEventListener\']("wheel", onWheel);\r\n                    }\r\n                    else if (\'onmousewheel\' in document) {\r\n                        // устаревший вариант события\r\n                        ob[\'addEventListener\']("mousewheel", onWheel);\r\n                    }\r\n                    else {\r\n                        // Firefox < 17\r\n                        ob[\'addEventListener\']("MozMousePixelScroll", onWheel);\r\n                    }\r\n                }\r\n                else { // IE8-\r\n                    ob[\'attachEvent\']("onmousewheel", onWheel);\r\n                }\r\n                ;\r\n                function onWheel(e) {\r\n                    e = e || window.event;\r\n                    var delta = e.deltaY || e.detail || e.wheelDelta;\r\n                    delta = delta / Math.abs(delta);\r\n                    fn.call(txis, delta * .1);\r\n                    //console.log(e);\r\n                }\r\n                ;\r\n                fnScroll = {\r\n                    el: this,\r\n                    fn: fn\r\n                };\r\n            },\r\n            move: function (fn) {\r\n                this.html.addEventListener("mousemove", mv);\r\n                this.html.addEventListener("touchmove", mv);\r\n                function mv(event) {\r\n                    fn.call(txis, event);\r\n                    //event.preventDefault();event.stopPropagation();return false;\r\n                }\r\n            },\r\n            over: function (fn) {\r\n                this.html.addEventListener("mouseover", dw);\r\n                function dw(event) {\r\n                    fn.call(txis, event);\r\n                    //event.preventDefault ? event.preventDefault() : (event.returnValue = false);\r\n                    // event.preventDefault();event.stopPropagation();return false;\r\n                }\r\n            },\r\n            out: function (fn) {\r\n                this.html.addEventListener("mouseout", dw);\r\n                function dw(event) {\r\n                    fn.call(txis, event);\r\n                    //event.preventDefault ? event.preventDefault() : (event.returnValue = false);\r\n                    //event.preventDefault();event.stopPropagation();return false;\r\n                }\r\n            },\r\n            up: function (fn) {\r\n                this.html.addEventListener(\'mouseup\', up, false);\r\n                this.html.addEventListener("touchend", up, false);\r\n                this.html.addEventListener("touchcancel", up, false);\r\n                this.html.addEventListener("touchleave", up, false);\r\n                // this.html.addEventListener( "mouseout", up, false );\r\n                this.html.addEventListener(\'contextmenu\', function (e) { e.preventDefault ? e.preventDefault() : (e.returnValue = false); }, false);\r\n                function up(event) {\r\n                    fn.call(txis, event);\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                    return false;\r\n                }\r\n            },\r\n            scale: function (fn) {\r\n                if (this.html[\'addEventListener\']) {\r\n                    if (\'onwheel\' in document) {\r\n                        // IE9+, FF17+, Ch31+\r\n                        this.html[\'addEventListener\']("wheel", onWheel);\r\n                    }\r\n                    else if (\'onmousewheel\' in document) {\r\n                        // устаревший вариант события\r\n                        this.html[\'addEventListener\']("mousewheel", onWheel);\r\n                    }\r\n                    else {\r\n                        // Firefox < 17\r\n                        this.html[\'addEventListener\']("MozMousePixelScroll", onWheel);\r\n                    }\r\n                }\r\n                else { // IE8-\r\n                    this.html[\'attachEvent\']("onmousewheel", onWheel);\r\n                }\r\n                ;\r\n                function onWheel(e) {\r\n                    e = e || window.event;\r\n                    var delta = e.deltaY || e.detail || e.wheelDelta;\r\n                    delta = delta / Math.abs(delta);\r\n                    scl(delta);\r\n                    // e.preventDefault();e.stopPropagation();return false;\r\n                }\r\n                ;\r\n                function scl(delta) {\r\n                    fn.call(txis, delta);\r\n                }\r\n            },\r\n            addEvent: function (par) {\r\n                // if (this.name=="door") console.log("addEvent",this);\r\n                addEvent(__assign(__assign({}, par), { el: this }));\r\n            }\r\n        };\r\n        for (var k in par)\r\n            if (install_par[k])\r\n                install_par[k].call(_this_1, par[k]);\r\n        //console.log(composit);\r\n        if (par[\'layer\']) {\r\n            if (par[\'name\'] && !par[\'layer\'][par[\'name\']]) {\r\n                par[\'layer\'][par[\'name\']] = _this_1;\r\n            }\r\n        }\r\n        ;\r\n        txis.html[\'setAttribute\']("data-name", txis.name);\r\n        txis[\'setOption\'] = function (op) {\r\n            for (var k in op)\r\n                if (install_par[k])\r\n                    install_par[k].call(this, op[k]);\r\n        };\r\n        return _this_1;\r\n    }\r\n    return LayGroupHTML;\r\n}(LayGroup));\r\n;\r\nvar class_layers = new LayBegin({ name: "begin" });\r\nvar ob_anm = (/* unused pure expression or super */ null && ([]));\r\nfunction stop_anim(el) {\r\n    for (var key in ob_anm)\r\n        if (ob_anm[key] === el)\r\n            delete ob_anm[key];\r\n}\r\n;\r\nvar dataTik = 0;\r\nfunction anim(dat) {\r\n    //el,tm\r\n    var kl_el = false;\r\n    if (dat.el) {\r\n        for (var key in ob_anm)\r\n            if (ob_anm[key] === dat.el)\r\n                delete ob_anm[key];\r\n        dat.el.st_time = dataTik;\r\n        if (dat.time < 1)\r\n            dat.time = 1;\r\n        dat.el.en_time = dat.time;\r\n        if (!dat.el.end_vp)\r\n            dat.el.end_vp = function () { };\r\n        if (!dat.el.poz_sm)\r\n            dat.el.poz_sm = 0;\r\n        ob_anm.push(dat.el);\r\n        var kl = -1;\r\n        for (var key in ob_anm)\r\n            kl++;\r\n        if (kl > 0)\r\n            return;\r\n    }\r\n    ;\r\n    //this.info_str(ee);\r\n    //sv.a_cam_rend[1].a_rend();\r\n    //if (kl_el) {requestAnimationFrame(function(){anim({})});} ;\r\n}\r\n;\r\nvar arMoveSubject = (/* unused pure expression or super */ null && ([]));\r\nfunction ticAnim(d) {\r\n    dataTik = d;\r\n    for (var key in ob_anm) {\r\n        var tm = (d - ob_anm[key].st_time) / ob_anm[key].en_time + ob_anm[key].poz_sm;\r\n        //console.log(ob_anm[key].en_time);\r\n        if (tm > 1) {\r\n            ob_anm[key].anim(1);\r\n            var e = ob_anm[key];\r\n            delete ob_anm[key];\r\n            e.poz_sm = 0;\r\n            e.end_vp();\r\n        }\r\n        else\r\n            ob_anm[key].anim(tm);\r\n    }\r\n    ;\r\n    for (var i = 0; i < arMoveSubject.length; i++)\r\n        arMoveSubject[i].moveTik(d);\r\n}\r\nfunction len_to_line(pr) {\r\n    var ax = pr.point[0] - pr.line[0][0];\r\n    var ay = pr.point[1] - pr.line[0][1];\r\n    var bx = pr.line[1][0] - pr.line[0][0];\r\n    var by = pr.line[1][1] - pr.line[0][1];\r\n    var ab = ax * bx + ay * by;\r\n    var l = Math.sqrt(Math.pow(bx, 2) + Math.pow(by, 2));\r\n    var kf = ab / l / l;\r\n    //if (kf<0 || kf>1) return false;\r\n    var cr = [pr.line[0][0] + (pr.line[1][0] - pr.line[0][0]) * kf, pr.line[0][1] + (pr.line[1][1] - pr.line[0][1]) * kf];\r\n    return { cord: cr, len: Math.sqrt(Math.pow(pr.point[0] - cr[0], 2) + Math.pow(pr.point[1] - cr[1], 2)), lies: (kf < 0 || kf > 1), kf: kf, lenLine: l };\r\n}\r\n;\r\nvar LayInput = /** @class */ (function (_super) {\r\n    __extends(LayInput, _super);\r\n    function LayInput(par) {\r\n        var _this_1 = _super.call(this, par) || this;\r\n        var txis = _this_1;\r\n        new LayGroupHTML({ style: { position: "", display: "inline-block" }, innerHTML: par.nameInput, parent: _this_1 });\r\n        var st = { position: "" };\r\n        if (par.styleInput)\r\n            for (var k in par.styleInput)\r\n                st[k] = par.styleInput[k];\r\n        var inp = new LayGroupHTML({ tag: "input", style: st, parent: _this_1 });\r\n        if (par.type) {\r\n            inp.html[\'setAttribute\']("type", par.type);\r\n        }\r\n        ;\r\n        if (par.sizeWidth)\r\n            inp.html[\'style\'].width = par.sizeWidth;\r\n        inp.html[\'onkeypress\'] = function (value) { if (value.keyCode == 13)\r\n            this.blur(); };\r\n        inp.html[\'onblur\'] = function () {\r\n            change.call(this);\r\n        };\r\n        inp.html[\'onchange\'] = function () {\r\n            change.call(this);\r\n        };\r\n        function change() {\r\n            par.linkValue[par.nameValue] = this.value;\r\n            if (par.change)\r\n                par.change();\r\n        }\r\n        inp.html[\'value\'] = par.linkValue[par.nameValue];\r\n        return _this_1;\r\n    }\r\n    return LayInput;\r\n}(LayGroupHTML));\r\n;\r\nfunction class_ajax(ur, fn) {\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open("GET", ur, true);\r\n    xhr[\'fn\'] = fn;\r\n    xhr.onreadystatechange = function () {\r\n        if (xhr.readyState != 4)\r\n            return;\r\n        if (xhr.responseText && xhr.responseText != undefined) {\r\n            var tt = xhr.responseText;\r\n            this[\'fn\'](tt);\r\n        }\r\n        ;\r\n    };\r\n    xhr.send();\r\n}\r\n;\r\nfunction insertStructSVG(el) {\r\n    var ar = [];\r\n    for (var i = 0; i < el.html.childNodes.length; ++i)\r\n        if (el.html.childNodes[i].hasAttribute && el.html.childNodes[i].hasAttribute("onload")) {\r\n            ar.push(el.html.childNodes[i]);\r\n        }\r\n    ;\r\n    for (var i = 0; i < ar.length; i++) {\r\n        var g = new LayGroupHTML({\r\n            svg: true,\r\n            parent: el,\r\n            name: ar[i].getAttribute("onload"),\r\n            elementInsert: ar[i]\r\n        });\r\n        insertStructSVG(g);\r\n        ar[i].remove();\r\n    }\r\n    ;\r\n}\r\n;\r\nvar class_event = {};\r\nfunction addEvent(par) {\r\n    for (var k in class_event)\r\n        if (class_event[k].el) {\r\n            var el = class_event[k].el.html;\r\n            while (el.parentNode)\r\n                el = el.parentNode;\r\n            if (el !== document)\r\n                delete class_event[k];\r\n        }\r\n    ;\r\n    if (!par.name)\r\n        par.name = "";\r\n    if (class_event[par.name]) {\r\n        var e = 0;\r\n        while (class_event[par.name + e + ""])\r\n            e++;\r\n        // console.log({... par},e,event[par.name+e+""]);\r\n        par.name = par.name + e + "";\r\n    }\r\n    ;\r\n    class_event[par.name] = {};\r\n    /* var ee=[\'\']\r\n    for (var k in par) if (k!=name) {\r\n        event[par.name][k]=par[k];\r\n    }; */\r\n    class_event[par.name] = par;\r\n    return class_event[par.name];\r\n}\r\n;\r\nvar ButtonSvg = /** @class */ (function (_super) {\r\n    __extends(ButtonSvg, _super);\r\n    function ButtonSvg(par) {\r\n        var _this_1 = this;\r\n        par.style = { position: "", display: "inline-block", cursor: "pointer" };\r\n        par.resize = function () {\r\n            //console.log(this);  \r\n        };\r\n        par.down = function () {\r\n            this.funControl.activ();\r\n            if (par.fnClick)\r\n                par.fnClick();\r\n        };\r\n        _this_1 = _super.call(this, par) || this;\r\n        var txis = _this_1;\r\n        _this_1[\'funControl\'] = {\r\n            activ: function () {\r\n                for (var i = 0; i < txis.parent[\'children\'].length; i++) {\r\n                    txis.parent[\'children\'][i].children[0].child_name[\'activ\'].html.style.display = "none";\r\n                    //console.log(txis.parent[\'children\'][i]);\r\n                }\r\n                ;\r\n                txis.children[0].child_name[\'activ\'].html.style.display = "block";\r\n                //console.log(txis);\r\n            }\r\n        };\r\n        var ww = [par.elSvg.kor[2] - par.elSvg.kor[0], par.elSvg.kor[3] - par.elSvg.kor[1]];\r\n        var s = new LayGroupHTML({\r\n            tag: "svg",\r\n            svg: true,\r\n            attribute: { width: ww[0], height: ww[1] },\r\n            parent: _this_1,\r\n            childrenElem: [\r\n                new LayGroupHTML({\r\n                    svg: true,\r\n                    tag: "g",\r\n                    elementInsert: par.elSvg,\r\n                    resize: function () {\r\n                        var k = readCord(this.html);\r\n                        write_matrix(this.html, [[1, 0, 0], [0, 1, 0], [-k[0], -k[1], 1]]);\r\n                    }\r\n                }),\r\n                new LayGroupHTML({\r\n                    svg: true,\r\n                    tag: "rect",\r\n                    name: "activ",\r\n                    attribute: { "x": 5, y: 5, width: ww[0] - 10, height: ww[1] - 10, stroke: "#EFE135", "stroke-width": "3", fill: "none", "rx": 12, "ry": 12, opacity: .6 }\r\n                })\r\n            ]\r\n        });\r\n        return _this_1;\r\n        //this[\'funControl\'].activ();\r\n    }\r\n    ;\r\n    return ButtonSvg;\r\n}(LayGroupHTML));\r\n;\r\nfunction converCord(event) {\r\n    var point_ = [0, 0];\r\n    var ret = {\r\n        cord: [0, 0],\r\n        button: event.button,\r\n        len_point: 0,\r\n        twoTouch: false,\r\n        angle: 0\r\n    };\r\n    if (event.touches && event.touches.length > 0) {\r\n        point_ = [event.touches[0].pageX, event.touches[0].pageY];\r\n        if (event.touches.length > 1) {\r\n            ret.len_point = Math.pow(event.touches[1].pageX - event.touches[0].pageX, 2) + Math.pow(event.touches[1].pageY - event.touches[0].pageY, 2);\r\n            ret.twoTouch = true;\r\n            ret.angle = Math.atan2(event.touches[1].pageY - event.touches[0].pageY, event.touches[1].pageX - event.touches[0].pageX);\r\n        }\r\n        ;\r\n    }\r\n    else\r\n        point_ = [event.pageX, event.pageY];\r\n    //point_=[point_[0]-canvPar.left,point_[1]-canvPar.top];\r\n    //ret[\'cord\']=new THREE.Vector3(((point_[0])/ controlScene.canvasSize.width ) * 2 - 1,- ( (point_[1]) /controlScene.canvasSize.height ) * 2 + 1,0);\r\n    ret[\'cord\'] = point_;\r\n    /* event.preventDefault ? event.preventDefault() : (event.returnValue = false);\r\n    event.stopPropagation(); */\r\n    return ret;\r\n}\r\n;\r\nvar class_lineSegmentsIntersect = function (l1, l2) {\r\n    //console.log(\'22\',l1,l2);\r\n    //x1, y1, x2, y2, x3, y3, x4, y4\r\n    var x1 = l1[0][0];\r\n    var x2 = l1[1][0];\r\n    var y1 = l1[0][1];\r\n    var y2 = l1[1][1];\r\n    var x3 = l2[0][0];\r\n    var x4 = l2[1][0];\r\n    var y3 = l2[0][1];\r\n    var y4 = l2[1][1];\r\n    var a_dx = x2 - x1;\r\n    var a_dy = y2 - y1;\r\n    var b_dx = x4 - x3;\r\n    var b_dy = y4 - y3;\r\n    var s = (-a_dy * (x1 - x3) + a_dx * (y1 - y3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    var t = (+b_dx * (y1 - y3) - b_dy * (x1 - x3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    if (!s)\r\n        s = 0;\r\n    if (!t)\r\n        t = 0;\r\n    return (s >= 0 && s <= 1 && t >= 0 && t <= 1) ? [x1 + t * a_dx, y1 + t * a_dy] : false;\r\n};\r\nvar lineSegmentsIntersectBool = function (l1, l2) {\r\n    //console.log(\'22\',l1,l2);\r\n    //x1, y1, x2, y2, x3, y3, x4, y4\r\n    var x1 = l1[0][0];\r\n    var x2 = l1[1][0];\r\n    var y1 = l1[0][1];\r\n    var y2 = l1[1][1];\r\n    var x3 = l2[0][0];\r\n    var x4 = l2[1][0];\r\n    var y3 = l2[0][1];\r\n    var y4 = l2[1][1];\r\n    var a_dx = x2 - x1;\r\n    var a_dy = y2 - y1;\r\n    var b_dx = x4 - x3;\r\n    var b_dy = y4 - y3;\r\n    var a = (-b_dx * a_dy + a_dx * b_dy);\r\n    var b = (-b_dx * a_dy + a_dx * b_dy);\r\n    var s = 0;\r\n    var t = 0;\r\n    var ret = false;\r\n    if (a != 0 && b != 0) {\r\n        s = (-a_dy * (x1 - x3) + a_dx * (y1 - y3)) / a;\r\n        t = (+b_dx * (y1 - y3) - b_dy * (x1 - x3)) / b;\r\n        if (!s)\r\n            s = 0;\r\n        if (!t)\r\n            t = 0;\r\n        if (s > 0 && s < 1 && t > 0 && t < 1)\r\n            ret = true;\r\n    }\r\n    ;\r\n    return ret;\r\n};\r\nfunction class_lenPoint(ar) {\r\n    return Math.sqrt(Math.pow(ar[1][0] - ar[0][0], 2) + Math.pow(ar[1][1] - ar[0][1], 2));\r\n}\r\n;\r\nfunction angLine(crLine1, crLine2) {\r\n    // var crLine1 = [el.cord[index^1].slice(),el.cord[index].slice()];\r\n    //var crLine2 = [el.edgeLink[index].edge.cord[el.edgeLink[index].indexPoint].slice(),el.edgeLink[index].edge.cord[el.edgeLink[index].indexPoint^1].slice()];\r\n    var a1 = Math.atan2(crLine1[1][1] - crLine1[0][1], crLine1[1][0] - crLine1[0][0]);\r\n    var mt = new Mt3().trans(-crLine2[0][0], -crLine2[0][1]).rotX(-a1);\r\n    var cr = new Mt3().trans(crLine2[1][0], crLine2[1][1]).multiply(mt).elements.slice(6, 8);\r\n    //console.log(crLine1,crLine2);\r\n    return Math.PI - Math.atan2(cr[1], cr[0]);\r\n}\r\n;\r\nfunction createD(ar) {\r\n    var d = "M".concat(ar[0] + "", " L");\r\n    for (var i = 1; i < ar.length; ++i)\r\n        d += "".concat(ar[i] + "", " ");\r\n    return d;\r\n}\r\n;\r\nvar Loop = /** @class */ (function () {\r\n    function Loop() {\r\n        this.run = function () {\r\n            return new Promise(function (f, e) {\r\n            });\r\n        };\r\n        this.setFn = function (f, count) {\r\n        };\r\n        this.stop = function () { };\r\n        this.delay = 7;\r\n        var fn = function (i) { };\r\n        var clTime;\r\n        var count = 0;\r\n        var index = 0;\r\n        var oldError = function (i) { };\r\n        var _this = this;\r\n        this.run = function () {\r\n            if (index)\r\n                oldError({\r\n                    status: false,\r\n                    lastIndex: index - 1\r\n                });\r\n            return new Promise(function (f) {\r\n                //\r\n                oldError = f;\r\n                index = 0;\r\n                function cicl() {\r\n                    clearTimeout(clTime);\r\n                    clTime = setTimeout(function () { return cicl(); }, 5);\r\n                    var stT = new Date().getTime();\r\n                    function c() {\r\n                        fn(index);\r\n                        ++index;\r\n                        if (index == count) {\r\n                            f({\r\n                                status: true\r\n                            });\r\n                            index = 0;\r\n                            clearTimeout(clTime);\r\n                        }\r\n                        else if ((new Date().getTime() - stT) < _this.delay) {\r\n                            c();\r\n                        } //else console.log(_this.delay);\r\n                    }\r\n                    ;\r\n                    c();\r\n                }\r\n                ;\r\n                if (!count) {\r\n                    f({ status: true });\r\n                }\r\n                else\r\n                    cicl();\r\n            });\r\n        };\r\n        this.stop = function () {\r\n            clearTimeout(clTime);\r\n            oldError({\r\n                status: false,\r\n                lastIndex: index - 1\r\n            });\r\n        };\r\n        this.setFn = function (f, cn) {\r\n            fn = f;\r\n            count = cn;\r\n        };\r\n    }\r\n    return Loop;\r\n}());\r\n;\r\n/* let lp = new Loop();// пример использования\r\nfunction ff(index){\r\n        let i=0;\r\n        while (i<1e7) i++;\r\n        console.log("------",index);\r\n    }\r\nlp.setFn(\r\n    ff,\r\n    10\r\n);\r\nlp.run().then(\r\n    ()=>console.log("run","313"),\r\n    ()=>console.log("erorr","55")\r\n);\r\nsetTimeout(()=>{\r\n    console.log(77);\r\n    lp.setFn(\r\n        ff,\r\n        2\r\n    );\r\n    lp.run().then(\r\n    ()=>console.log("run","D313"),\r\n    ()=>console.log("erorr","D55")\r\n);\r\n},205); */\r\n//console.log(l);\r\n\r\n\n;// CONCATENATED MODULE: ./modul_shapes/src/expan.js\nfunction buildD(arDecompres){\r\n    var s="";\r\n    for (var i=0;i<arDecompres.length;i++) {\r\n        var e=parseFloat(arDecompres[i]);\r\n        if (e) {s+=e+" "} else s+=arDecompres[i]+" ";\r\n    };\r\n    return s;\r\n};\r\nfunction zp(el,x,y) {\r\n            \r\n    if (!el.kor) el.kor=[x,y,x,y];\r\n    if (x<el.kor[0]) el.kor[0]=x;\r\n    if (y<el.kor[1]) el.kor[1]=y;\r\n    if (x>el.kor[2]) el.kor[2]=x;\r\n    if (y>el.kor[3]) el.kor[3]=y;\r\n    if (el.parentNode){\r\n        if (!el.parentNode.kor) el.parentNode.kor=[x,y,x,y];\r\n        if (x<el.parentNode.kor[0]) el.parentNode.kor[0]=x;\r\n        if (y<el.parentNode.kor[1]) el.parentNode.kor[1]=y;\r\n        if (x>el.parentNode.kor[2]) el.parentNode.kor[2]=x;\r\n        if (y>el.parentNode.kor[3]) el.parentNode.kor[3]=y;\r\n        \r\n    };\r\n    el.kor[4]=el.kor[0]+(el.kor[2]-el.kor[0])/2;\r\n    el.kor[5]=el.kor[1]+(el.kor[3]-el.kor[1])/2;\r\n};\r\nfunction buildDtoMatrix(el,mt) {\r\n    var ar=el.getAttribute("d").split(/[ ,]/);\r\n          var s="";\r\n          for (var j=0;j<ar.length;j++) if (~ar[j].search(/[A-Zz]/) || !ar[j]) {s+=ar[j]+" "} else {\r\n              var x=parseFloat(ar[j]);\r\n              j++;\r\n              var y=parseFloat(ar[j]);\r\n              //var kr=proiz_matr([[1,0,0],[0,1,0],[x,y,1]],a);\r\n              var kr=new expan_Mt3().trans(x,y).multiply(mt);\r\n              s+=kr.elements[6]+","+kr.elements[7]+" ";\r\n              zp(el,kr.elements[6],kr.elements[7]);\r\n          };\r\n          el.setAttribute("d",s);\r\n};\r\n\r\nfunction boxMatrix(d,boxout,margin){\r\n    margin = 0;\r\n    var ar=d.split(/[ ,]/);\r\n    var mt = new expan_Mt3();\r\n    var s="";\r\n    var mn_mx = [];\r\n    //console.log(d,ar)\r\n    for (var j=0;j<ar.length;j++) if (~ar[j].search(/[A-Zz]/) || !ar[j]) {} else {\r\n        var x=parseFloat(ar[j]);\r\n        j++;\r\n        var y=parseFloat(ar[j]);\r\n        //console.log(x,y);\r\n        if (!mn_mx.length) mn_mx=[x,y,x,y];\r\n        mn_mx[0] = Math.min(mn_mx[0],x); mn_mx[1] = Math.min(mn_mx[1],y);\r\n        mn_mx[2] = Math.max(mn_mx[2],x); mn_mx[3] = Math.max(mn_mx[3],y);\r\n    };\r\n    \r\n    var sc = Math.min ((boxout[0]-margin*2)/(mn_mx[2]-mn_mx[0]),(boxout[1]-margin*2)/(mn_mx[3]-mn_mx[1]));\r\n    mt.trans(-mn_mx[0]-(mn_mx[2]-mn_mx[0])/2,-mn_mx[1]-(mn_mx[3]-mn_mx[1])/2).scale(sc,sc).trans(boxout[0]/2,boxout[1]/2);\r\n    \r\n    for (var j=0;j<ar.length;j++) if (~ar[j].search(/[A-Zz]/) || !ar[j]) {s+=ar[j]+" "} else {\r\n        var x=parseFloat(ar[j]);\r\n        j++;\r\n        var y=parseFloat(ar[j]);\r\n        var kr=new expan_Mt3().trans(x,y).multiply(mt);\r\n        s+=Math.round(kr.elements[6]*1000)/1000+","+Math.round(kr.elements[7]*1000)/1000+" ";\r\n    };\r\n\r\n    return {d:s,mt,mn_mx};\r\n    //el.setAttribute("d",s);\r\n}\r\n\r\n\r\nfunction expan_substitutionPath(ob) {\r\n    var atrib=["style","transform","fill-rule","clip-rule","fill","stroke","stroke-width","stroke-miterlimit","clip-path","fill-opacity","stroke-dasharray","stroke-linecap","dashoffset","stroke-linecap","sroke-linejoin","onload","display","opacity"];\r\n    \r\n    function  perenos_atrib(a,b){\r\n        \r\n        for (var i=0;i<atrib.length;i++) {\r\n            if (b.hasAttribute(atrib[i])) a.setAttribute(atrib[i],b.getAttribute(atrib[i]));\r\n        };\r\n    };\r\n    function parenosAttr_v_style(ob) {\r\n        var atrib=["fill-rule","clip-rule","fill","stroke","stroke-width","stroke-miterlimit","clip-path","fill-opacity","stroke-dasharray","stroke-linecap","dashoffset","stroke-linecap","sroke-linejoin","display","opacity",""];\r\n        for (var i=0;i<atrib.length;i++) {\r\n            if (ob.hasAttribute(atrib[i])) {ob.style[atrib[i]]=ob.getAttribute(atrib[i]);ob.removeAttribute(atrib[i]);};\r\n        };\r\n    };\r\n       \r\n       var b=ob.getElementsByTagName("glyph");\r\n         for (var t=0;t<b.length;t++){ \r\n           b[t].setAttribute("unicode",b[t].getAttribute("unicode").charCodeAt(0));\r\n           var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path");\r\n            if (b[t].hasAttribute("d")) {c.setAttribute("d",b[t].getAttribute("d"));} else c.setAttribute("d","M0,0 L0,0");\r\n            c.setAttribute("unicode",b[t].getAttribute("unicode"));\r\n            c.setAttribute("horiz-adv-x",b[t].getAttribute("horiz-adv-x"));\r\n            b[t].parentNode.insertBefore(c,b[t]);\r\n         };\r\n     while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("glyph");}\r\n     \r\n        var b=ob.getElementsByTagName("defs");\r\n         for (var t=0;t<b.length;t++){ \r\n          \r\n            var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"g");\r\n            c.innerHTML=b[t].innerHTML;\r\n           // c.setAttribute("display","none");\r\n            b[t].parentNode.insertBefore(c,b[t]);\r\n         };\r\n     while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("defs");}\r\n     \r\n      var b=ob.getElementsByTagName("line");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             var x1=parseFloat(b[t].getAttribute("x1"));\r\n             var y1=parseFloat(b[t].getAttribute("y1"));\r\n             var x2=parseFloat(b[t].getAttribute("x2"));\r\n             var y2=parseFloat(b[t].getAttribute("y2")); \r\n             var t1="M"+" "+x1+","+y1+" "+"L"+" "+x2+","+y2;\r\n             c.setAttribute("d",t1);\r\n             perenos_atrib(c,b[t]);\r\n             b[t].parentNode.insertBefore(c,b[t]);\t \r\n         };\r\n      while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("line");}\r\n      \r\n      var b=ob.getElementsByTagName("rect");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             var x1=0;\r\n             var y1=0;\r\n             if (b[t].hasAttribute("x")) var x1=parseFloat(b[t].getAttribute("x"));\r\n             if (b[t].hasAttribute("y")) var y1=parseFloat(b[t].getAttribute("y"));\r\n             var x2=x1+parseFloat(b[t].getAttribute("width"));\r\n             var y2=y1+parseFloat(b[t].getAttribute("height")); \r\n             var t1="M"+" "+x1+","+y1+" "+"L"+" "+x2+","+y1+" "+"L"+" "+x2+","+y2+" "+"L"+" "+x1+","+y2+" "+"z";\r\n             if (b[t].hasAttribute("rx")) {\r\n                   var rx=parseFloat(b[t].getAttribute("rx"));\r\n                   var ry=rx;\r\n                   if (b[t].hasAttribute("ry")) ry=parseFloat(b[t].getAttribute("ry"));\r\n                   t1="M"+" "+x1+","+(y1+ry)+" "+"S"+" "+(x1)+","+(y1)+" "+(x1+rx)+","+(y1)+"L"+" "+(x2-rx)+","+y1+"S"+" "+(x2)+","+(y1)+" "+(x2)+","+(y1+ry)+"L"+" "+(x2)+","+(y2-ry)+"S"+" "+(x2)+","+(y2)+" "+(x2-rx)+","+(y2)+"L"+" "+(x1+rx)+","+y2+" "+"S"+" "+(x1)+","+(y2)+" "+(x1)+","+(y2-ry)+" "+"z";\r\n                 };\r\n             c.setAttribute("d",t1);\r\n             perenos_atrib(c,b[t]);\r\n             b[t].parentNode.insertBefore(c,b[t]);\t \r\n         };\r\n       while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("rect");}\r\n       \r\n       var b=ob.getElementsByTagName("circle");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             perenos_atrib(c,b[t]);\r\n             var x=parseFloat(b[t].getAttribute("cx"));\r\n             var y=parseFloat(b[t].getAttribute("cy"));\r\n             var rr=parseFloat(b[t].getAttribute("r"));\r\n             var t1="M"+" "+(x-rr)+","+y+"S"+" "+(x-rr)+","+(y-rr)+" "+(x)+","+(y-rr)+"L"+" "+(x)+","+(y-rr)+"S"+" "+(x+rr)+","+(y-rr)+" "+(x+rr)+","+(y)+"L"+" "+(x+rr)+","+(y)+"S"+" "+(x+rr)+","+(y+rr)+" "+(x)+","+(y+rr)+"L"+" "+(x)+","+(y+rr)+"S"+" "+(x-rr)+","+(y+rr)+" "+(x-rr)+","+(y)+"z";\r\n             c.setAttribute("d",t1);\r\n             b[t].parentNode.insertBefore(c,b[t]);\r\n            };\r\n       while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("circle");}\r\n    \r\n       var b=ob.getElementsByTagName("ellipse");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             perenos_atrib(c,b[t]);\r\n             var x=parseFloat(b[t].getAttribute("cx"));\r\n             var y=parseFloat(b[t].getAttribute("cy"));\r\n             var rx=parseFloat(b[t].getAttribute("rx"));\r\n             var ry=parseFloat(b[t].getAttribute("ry"));\r\n             var t1="M"+" "+(x-rx).toFixed(3)+","+y.toFixed(3)+" "+"S"+" "+(x-rx).toFixed(3)+","+(y-ry).toFixed(3)+" "+(x).toFixed(3)+","+(y-ry).toFixed(3)+" "+"L"+" "+(x).toFixed(3)+","+(y-ry).toFixed(3)+" "+"S"+" "+(x+rx).toFixed(3)+","+(y-ry).toFixed(3)+" "+(x+rx).toFixed(3)+","+(y).toFixed(3)+" "+"L"+" "+(x+rx).toFixed(3)+","+(y).toFixed(3)+" "+"S"+" "+(x+rx).toFixed(3)+","+(y+ry).toFixed(3)+" "+(x).toFixed(3)+","+(y+ry).toFixed(3)+" "+"L"+" "+(x).toFixed(3)+","+(y+ry).toFixed(3)+" "+"S"+" "+(x-rx).toFixed(3)+","+(y+ry).toFixed(3)+" "+(x-rx).toFixed(3)+","+(y).toFixed(3)+" z";\r\n             //alert(t1);\r\n             c.setAttribute("d",t1);\r\n             b[t].parentNode.insertBefore(c,b[t]);\r\n            };\t \r\n         while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("ellipse");}\r\n         \r\n          var b=ob.getElementsByTagName("polygon");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             if (b[t].id) {\r\n                 c.id=b[t].id;\r\n             };\r\n             perenos_atrib(c,b[t]);\r\n             var point=b[t].getAttribute("points").split(" ");\r\n             for (var i=0;i<point.length;i++) if (!point[i]) point.splice(i,1);\r\n             for (var i=0;i<point.length;i++) {\r\n                 zp(c,parseFloat(point[i].split(",")[0]),parseFloat(point[i].split(",")[1]));\r\n             };\r\n            \r\n             point[0]="M "+point[0];\r\n             point[1]="L "+point[1];\r\n             \r\n             point.push("z");\r\n             c.setAttribute("d",point.join(" "));\r\n              b[t].parentNode.insertBefore(c,b[t]);\r\n         };\r\n          while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("polygon");}\r\n          \r\n          var b=ob.getElementsByTagName("polyline");\r\n         for (var t=0;t<b.length;t++){ \r\n             var c=document.createElementNS(\'http:/\'+\'/www.w3.org/2000/svg\',"path"); \r\n             perenos_atrib(c,b[t]);\r\n             var point=b[t].getAttribute("points").split(" ");\r\n             for (var i=0;i<point.length;i++) if (!point[i]) point.splice(i,1);\r\n             for (var i=0;i<point.length;i++) zp(c,parseFloat(point[i].split(",")[0]),parseFloat(point[i].split(",")[1]));\r\n             point[0]="M "+point[0];\r\n             point[1]="L "+point[1];\r\n             \r\n             c.setAttribute("d",point.join(" "));\r\n              b[t].parentNode.insertBefore(c,b[t]);\r\n         };\r\n          while (b.length>0) {b[0].parentNode.removeChild(b[0]);b=ob.getElementsByTagName("polyline");}\r\n         \r\n         function new_kor(kor,matr) {\r\n             var k=proiz_matr([[1,0,0],[0,1,0],[kor[0],kor[1],1]],matr);\r\n             return [k[2][0],k[2][1]];\r\n             \r\n         };\r\n        \r\n         var b=ob.getElementsByTagName("path");\r\n         for (var t=0;t<b.length;t++){\r\n             \r\n        //  if (b[t].hasAttribute("onload") && ~b[t].getAttribute("onload").indexOf("this.napravl=true")) b[t].napravl=true;\r\n          var c=b[t].getAttribute("d");\r\n          var res=[];\r\n          var j=0;\r\n          res[j]="";\r\n          for (var i=0;i<c.length;i++) {\r\n             var r=c[i];\r\n              if (r=="-") {j++;res[j]=""};\r\n              if (!parseInt(r) && (r!="0") && (r!=".")  && (r!="-") ) {j++; res[j]=r; j++;res[j]=""} else{\r\n                 res[j]+=r; \r\n              };\r\n          };\r\n          for (i=0;i<res.length;i++) if ((res[i]==",") || (res[i]=="") || (res[i]==" ") || (res[i].charCodeAt(0)==9) || (res[i].charCodeAt(0)==10)) {\r\n               for (j=i;j<res.length-1;j++) res[j]=res[j+1];\r\n               res.length--;\r\n               i--;\r\n              };\r\n          \r\n          var tek_x=0;\r\n          var tek_y=0;\t\r\n          if (b[t].napravl) b[t].tohki=[];\r\n          for (i=0;i<res.length;i++) {\r\n              if (res[i]=="M") {tek_x=parseFloat(res[i+1]);tek_y=parseFloat(res[i+2]);zp(b[t],tek_x,tek_y);};\r\n              if (res[i]=="m") {tek_x+=parseFloat(res[i+1]);res[i+1]=tek_x;tek_y+=parseFloat(res[i+2]);res[i+2]=tek_y;res[i]="M";zp(b[t],tek_x,tek_y);};\r\n              if (res[i]=="C") {tek_x=parseFloat(res[i+5]);tek_y=parseFloat(res[i+6]);i=i+6;zp(b[t],tek_x,tek_y);;};\r\n              if (res[i]=="c") {\r\n                   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n                   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n                   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n                   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n                   res[i+5]=Math.round((parseFloat(res[i+5])+tek_x)*100)/100;\r\n                   res[i+6]=Math.round((parseFloat(res[i+6])+tek_y)*100)/100;\r\n                   tek_x=res[i+5];\r\n                   tek_y=res[i+6];\r\n                   for (var j=0;j<3;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n                   res[i]="C";\r\n                   i=i+6;\r\n                  };\r\n             if (res[i]=="S") {tek_x=parseFloat(res[i+3]);tek_y=parseFloat(res[i+4]);i=i+4;zp(b[t],tek_x,tek_y);;};\r\n             if (res[i]=="Q") {tek_x=parseFloat(res[i+3]);tek_y=parseFloat(res[i+4]);i=i+4;zp(b[t],tek_x,tek_y);;};\t\r\n             if (res[i]=="s") {\r\n                   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n                   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n                   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n                   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n                   tek_x=res[i+3];\r\n                   tek_y=res[i+4];\r\n                   for (var j=0;j<2;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n                   res[i]="S";\r\n                   i=i+4;\r\n                  };  \r\n              if (res[i]=="q") {\r\n                   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n                   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n                   res[i+3]=Math.round((parseFloat(res[i+3])+tek_x)*100)/100;\r\n                   res[i+4]=Math.round((parseFloat(res[i+4])+tek_y)*100)/100;\r\n                   for (var j=0;j<2;j++) zp(b[t],res[i+j*2+1],res[i+j*2+2]);\r\n                   tek_x=res[i+3];\r\n                   tek_y=res[i+4];\r\n                   res[i]="Q";\r\n                   i=i+4;\r\n                  }; \t  \r\n                  \r\n             if (res[i]=="L") {tek_x=Math.round(parseFloat(res[i+1])*100)/100;tek_y=Math.round(parseFloat(res[i+2])*100)/100;i=i+2;zp(b[t],tek_x,tek_y);;};\r\n    \r\n             if (res[i]=="l") {\r\n                   res[i+1]=Math.round((parseFloat(res[i+1])+tek_x)*100)/100;\r\n                   res[i+2]=Math.round((parseFloat(res[i+2])+tek_y)*100)/100;\r\n                   tek_x=res[i+1];\r\n                   tek_y=res[i+2];\r\n                   zp(b[t],tek_x,tek_y);\r\n                   res[i]="L";\r\n                   i=i+2;\r\n                  };\r\n              if (res[i]=="H") {tek_x=parseFloat(res[i+1]);res[i]="L"; for (var j=res.length;j>i+2;j--) res[j]=res[j-1];res[i+2]=tek_y;};  \r\n              if (res[i]=="V") {tek_y=parseFloat(res[i+1]);res[i]="L"; for (var j=res.length;j>i+1;j--) res[j]=res[j-1];res[i+1]=tek_x;}; \r\n              if (res[i]=="h") {tek_x+=parseFloat(res[i+1]);res[i+1]=tek_x;res[i]="L"; for (var j=res.length;j>i+2;j--) res[j]=res[j-1];res[i+2]=tek_y;};\r\n              if (res[i]=="v") {tek_y+=parseFloat(res[i+1]);res[i+1]=tek_y;res[i]="L"; for (var j=res.length;j>i+1;j--) res[j]=res[j-1];res[i+1]=tek_x;};\r\n              zp(b[t],tek_x,tek_y);   \r\n            };\t\r\n            var x=0;\r\n            var y=0;\r\n            var step=0;\r\n            if (b[t].napravl) for (i=0;i<res.length;i++) {\r\n                if (res[i]=="M") {i++;x=0;y=1;step=1};\r\n                if (res[i]=="L") {i++;x=0;y=1;step=1};\r\n                if (res[i]=="C") {i++;x=4;y=5;step=5};\r\n                if (res[i]=="S" || res[i]=="Q") {i++;x=2;y=3;step=3};\r\n                b[t].tohki.push([res[i+x],res[i+y]]);i+=step;\r\n            }\r\n        //b[t].setAttribute("decomposedD",res.slice()+"");\r\n        /* var s="";\r\n        for (var i=0;i<res.length;i++) {\r\n            var e=parseFloat(res[i]);\r\n            if (e) {s+=e+" "} else s+=res[i]+" ";\r\n        }; */\r\n        //console.log(b[t]);\r\n        if (b[t].napravl) {\r\n            for (var j=0;j<atrib.length;j++) if (b[t].style[atrib[j]]) b[t].style[atrib[j]]="";\r\n            for (var j=0;j<b[t].tohki.length-1;j++) {\r\n                if (j==0) {i=0;} else {i=b[t].tohki[j-1][2]};\r\n                var tt=true;\r\n                while (i<b[t].getTotalLength() && tt) {\r\n                      if (Math.round(b[t].getPointAtLength(i).x)==Math.round(b[t].tohki[j][0])) {b[t].tohki[j][2]=i;tt=false;}\r\n                      i++;\r\n                };\r\n            };\r\n            b[t].tohki[b[t].tohki.length-1][2]=b[t].getTotalLength();\r\n            for (var j=1;j<b[t].tohki.length;j++) {\r\n                b[t].tohki[j-1][3]=(b[t].tohki[j][2]-b[t].tohki[j-1][2])/(b[t].tohki[j][0]-b[t].tohki[j-1][0]);\r\n                //alert(b[t].tohki[j-1][3]+"  "+(b[t].tohki[j][2]));\r\n                b[t].tohki[j-1][0]=(b[t].tohki[j-1][0]-b[t].kor[0])/(b[t].kor[2]-b[t].kor[0]);\r\n                \r\n            };\r\n            var ss="";\r\n            for (var j=0;j<b[t].tohki.length-1;j++) {\r\n                \r\n                ss+=Math.round(b[t].tohki[j][0]*1000)/1000+","+Math.round(b[t].tohki[j][3]*1000)/1000+","+Math.round(b[t].tohki[j][2])+" ";\r\n            };\r\n            if (ss) b[t].setAttribute("date-kof",ss);\r\n        };\r\n        \r\n        b[t].setAttribute("d",buildD(res));\r\n        \r\n\r\n        parenosAttr_v_style(b[t]);\r\n        buildDtoMatrix(b[t],new expan_Mt3());\r\n\r\n        //console.log(b[t]);\r\n      };\r\n      \r\n       \r\n      //var el=ob.getElementsByTagName("g"); for (var j=0;j<el.length;j++) el[j].kor="";\r\n      \r\n      var gr=[];\r\n      \r\n      var el=ob.getElementsByTagName("radialGradient");\r\n      for (var i=0;i<el.length;i++) gr.push(el[i]);\r\n      /*var el=ob.getElementsByTagName("linearGradient");\r\n      for (var i=0;i<el.length;i++) gr.push(el[i]);*/\r\n      for (var i=0;i<gr.length;i++) {\r\n          //var a=[[1,0,0],[0,1,0],[0,0,1]];\r\n          ee=gr[i].parentNode;\r\n          while (ee)  {\r\n               //a=proiz_matr(a,read_matrix(ee,"transform"));\r\n               ee=ee.parentNode;\r\n          };\r\n      };\r\n      var el=ob.getElementsByTagName("path");\r\n    \r\n                \r\n                    \r\n      for (var i=0;i<el.length;i++) {\r\n          \r\n          //el[i].kor="";\r\n          //var a=[[1,0,0],[0,1,0],[0,0,1]];\r\n          var ee=el[i];\r\n        \r\n          /* while (ee)  {\r\n               //var a=proiz_matr(a,read_matrix(ee,"transform"));\r\n                \r\n               ee=ee.parentNode;\r\n                    \r\n          }; \r\n    \r\n          \r\n          var ar=el[i].getAttribute("d").split(/[ ,]/);\r\n          var s="";\r\n          for (var j=0;j<ar.length;j++) if (~ar[j].search(/[A-Zz]/) || !ar[j]) {s+=ar[j]+" "} else {\r\n              var x=parseFloat(ar[j]);\r\n              j++;\r\n              var y=parseFloat(ar[j]);\r\n              var kr=proiz_matr([[1,0,0],[0,1,0],[x,y,1]],a);\r\n              s+=kr[2][0]+","+kr[2][1]+" ";\r\n              zp(el[i],kr[2][0],kr[2][1]);\r\n          };\r\n          el[i].setAttribute("d",s);*/\r\n      };\r\n      var el=ob.getElementsByTagName("g");\r\n        for (var j=0;j<el.length;j++) {\r\n             for (var i=0;i<el.length;i++) if (el[i].kor) { \r\n                zp(el[i].parentNode,el[i].kor[0],el[i].kor[1]);\r\n                zp(el[i].parentNode,el[i].kor[2],el[i].kor[3]);\r\n             };\r\n            \r\n        };\r\n      var el=ob.getElementsByTagName("g");\r\n      for (var i=0;i<el.length;i++) {\r\n          if (el[i].hasAttribute("transform")) el[i].removeAttribute("transform")\r\n          el[i].setAttribute("kor",el[i].kor);\r\n          /* if (el[i].hasAttribute("onload")) {\r\n                //el[i].vipol=function(){eval (this.getAttribute("onload"))};\r\n                eval("el[i].intrface="+el[i].getAttribute("onload"));\r\n                //el[i].vipol();\r\n              //el[i].setAttribute("vipol",el[i].getAttribute("onload"));\r\n              el[i].removeAttribute("onload")\r\n              \r\n            }; */\r\n          if (el[i].id) el[i].removeAttribute("id");\r\n      };\r\n      var el=ob.getElementsByTagName("g");\r\n      var ud=[];\r\n      \r\n      \r\n       for (var i=0;i<ud.length;i++) ud[i].parentNode.removeChild(ud[i]);\r\n       \r\n      var el=ob.getElementsByTagName("path");\r\n       for (var i=0;i<el.length;i++) {\r\n          //  console.log(el[i]);\r\n          //el[i].setAttribute("kor",el[i].kor);\r\n          if (el[i].style["stroke-miterlimit"]) el[i].style["stroke-miterlimit"]="";\r\n          if (el[i].style["fill"]=="none" && (!el[i].parentNode.style["fill"] || el[i].parentNode.style["fill"]=="none")) {\r\n              el[i].style["fill"]="";\r\n              el[i].parentNode.style["fill"]="none";\r\n            \r\n          };\r\n          //if (el[i].hasAttribute("onload")) {el[i].setAttribute("vipol",el[i].getAttribute("onload"));el[i].removeAttribute("onload")};\r\n           \r\n      };\r\n      \r\n      return ob;\r\n    };\r\n\r\nfunction expan_read_matrix(el){\r\n    var type="transform";\r\n    var mt="";\r\n    try {\r\n        if (el && el.hasAttribute(type) && ~el.getAttribute(type).indexOf("matrix"))  mt=el.getAttribute(type);\r\n        if (el.style && el.style[type]) mt=el.style[type];\r\n    } catch (e) {};\r\n    \r\n    if (!mt) {return new expan_Mt3()};\r\n    var r=mt.split("(")[1];\r\n    if (~r.indexOf(",")) {r=r.split(",")} else r=r.split(" ");\r\n    for (var i=0;i<r.length;i++) r[i]=parseFloat(r[i]);\r\n    //var s=[[r[0],r[1],0],[r[2],r[3],0],[r[4],r[5],1]];\r\n    var m=new expan_Mt3();\r\n    m.elements[0]=r[0];\r\n    m.elements[1]=r[1];\r\n    m.elements[3]=r[2];\r\n    m.elements[4]=r[3];\r\n    m.elements[6]=r[4];\r\n    m.elements[7]=r[5];\r\n    return m;\r\n    };\r\n    \r\nfunction expan_write_matrix(el,a) { \r\nvar type="transform";\r\nvar s="matrix("+a.elements[0]+","+a.elements[1]+","+a.elements[3]+","+a.elements[4]+","+a.elements[6]+","+a.elements[7]+")";\r\nel.setAttribute(type,s);;\r\n\r\n};\r\n\r\nfunction multiplyMatrices( a, b ) {\r\n\r\nvar ae = a.elements;\r\nvar be = b.elements;\r\nvar te = [];\r\n\r\nvar a11 = ae[ 0 ], a12 = ae[ 3 ], a13 = ae[ 6 ];\r\nvar a21 = ae[ 1 ], a22 = ae[ 4 ], a23 = ae[ 7 ];\r\nvar a31 = ae[ 2 ], a32 = ae[ 5 ], a33 = ae[ 8 ];\r\n\r\nvar b11 = be[ 0 ], b12 = be[ 3 ], b13 = be[ 6 ];\r\nvar b21 = be[ 1 ], b22 = be[ 4 ], b23 = be[ 7 ];\r\nvar b31 = be[ 2 ], b32 = be[ 5 ], b33 = be[ 8 ];\r\n\r\nte[ 0 ] = a11 * b11 + a12 * b21 + a13 * b31;\r\nte[ 3 ] = a11 * b12 + a12 * b22 + a13 * b32;\r\nte[ 6 ] = a11 * b13 + a12 * b23 + a13 * b33;\r\n\r\nte[ 1 ] = a21 * b11 + a22 * b21 + a23 * b31;\r\nte[ 4 ] = a21 * b12 + a22 * b22 + a23 * b32;\r\nte[ 7 ] = a21 * b13 + a22 * b23 + a23 * b33;\r\n\r\nte[ 2 ] = a31 * b11 + a32 * b21 + a33 * b31;\r\nte[ 5 ] = a31 * b12 + a32 * b22 + a33 * b32;\r\nte[ 8 ] = a31 * b13 + a32 * b23 + a33 * b33;\r\n\r\nreturn te;\r\n\r\n}\r\n\r\nclass expan_Mt3 {\r\n    elements=[\r\n        1,0,0,\r\n        0,1,0,\r\n        0,0,1\r\n        ];\r\n    multiply=function (mt) {\r\n        this.elements=multiplyMatrices(mt,this);\r\n        return this;\r\n    };\r\n    rotX=function(ang){\r\n        var s=Math.sin(ang);\r\n        var c=Math.cos(ang);\r\n        var m=new expan_Mt3();\r\n        m.elements[0]=c;\r\n        m.elements[1]=s;\r\n        m.elements[3]=-s;\r\n        m.elements[4]=c;\r\n        this.multiply(m);\r\n        return this;\r\n    };\r\n    trans=function (a,b) {\r\n        this.elements[6]+=a;\r\n        this.elements[7]+=b;\r\n        return this;\r\n    };\r\n    transAr = function (ar){\r\n        this.elements[6]+=ar[0];\r\n        this.elements[7]+=ar[1];\r\n        return this;\r\n    };\r\n    scale=function (a,b){\r\n        var m=new expan_Mt3();\r\n        m.elements[0]=a;\r\n        m.elements[4]=b;\r\n        this.elements=multiplyMatrices(m,this);\r\n        return this;\r\n    };\r\n    scl=function(sc){\r\n        return this.scale(sc,sc);\r\n\r\n    }\r\n    clone=function () {\r\n        var m=new expan_Mt3();\r\n        m.elements=this.elements.slice();\r\n        return this;\r\n    };\r\n    constructor() { \r\n    }\r\n};\r\n\r\nfunction createProgram(gl, vertSh, fragSh) {\r\nfunction createShader(gl, type, source) {\r\n    var shader = gl.createShader(type);   // создание шейдера\r\n    gl.shaderSource(shader, source);      // устанавливаем шейдеру его программный код\r\n    gl.compileShader(shader);             // компилируем шейдер\r\n    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (success) {                        // если компиляция прошла успешно - возвращаем шейдер\r\n    return shader;\r\n    }\r\n    \r\n    console.log(gl.getShaderInfoLog(shader));\r\n    gl.deleteShader(shader);\r\n};\r\nvar vertexShader = createShader(gl, gl.VERTEX_SHADER, vertSh);\r\nvar fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragSh);\r\nvar program = gl.createProgram();\r\ngl.attachShader(program, vertexShader);\r\ngl.attachShader(program, fragmentShader);\r\ngl.linkProgram(program);\r\nvar success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\nif (success) {\r\n    return program;\r\n}\r\n\r\nconsole.log(gl.getProgramInfoLog(program));\r\ngl.deleteProgram(program);\r\n};\r\n\r\n\r\nfunction expanMatrix(m) {\r\nm.multiply=function (b) {\r\n    var a=this;\r\n    var a00 = a[0 * 4 + 0];\r\n    var a01 = a[0 * 4 + 1];\r\n    var a02 = a[0 * 4 + 2];\r\n    var a03 = a[0 * 4 + 3];\r\n    var a10 = a[1 * 4 + 0];\r\n    var a11 = a[1 * 4 + 1];\r\n    var a12 = a[1 * 4 + 2];\r\n    var a13 = a[1 * 4 + 3];\r\n    var a20 = a[2 * 4 + 0];\r\n    var a21 = a[2 * 4 + 1];\r\n    var a22 = a[2 * 4 + 2];\r\n    var a23 = a[2 * 4 + 3];\r\n    var a30 = a[3 * 4 + 0];\r\n    var a31 = a[3 * 4 + 1];\r\n    var a32 = a[3 * 4 + 2];\r\n    var a33 = a[3 * 4 + 3];\r\n    var b00 = b[0 * 4 + 0];\r\n    var b01 = b[0 * 4 + 1];\r\n    var b02 = b[0 * 4 + 2];\r\n    var b03 = b[0 * 4 + 3];\r\n    var b10 = b[1 * 4 + 0];\r\n    var b11 = b[1 * 4 + 1];\r\n    var b12 = b[1 * 4 + 2];\r\n    var b13 = b[1 * 4 + 3];\r\n    var b20 = b[2 * 4 + 0];\r\n    var b21 = b[2 * 4 + 1];\r\n    var b22 = b[2 * 4 + 2];\r\n    var b23 = b[2 * 4 + 3];\r\n    var b30 = b[3 * 4 + 0];\r\n    var b31 = b[3 * 4 + 1];\r\n    var b32 = b[3 * 4 + 2];\r\n    var b33 = b[3 * 4 + 3];\r\n    var m=[\r\n        b00 * a00 + b01 * a10 + b02 * a20 + b03 * a30,\r\n        b00 * a01 + b01 * a11 + b02 * a21 + b03 * a31,\r\n        b00 * a02 + b01 * a12 + b02 * a22 + b03 * a32,\r\n        b00 * a03 + b01 * a13 + b02 * a23 + b03 * a33,\r\n        b10 * a00 + b11 * a10 + b12 * a20 + b13 * a30,\r\n        b10 * a01 + b11 * a11 + b12 * a21 + b13 * a31,\r\n        b10 * a02 + b11 * a12 + b12 * a22 + b13 * a32,\r\n        b10 * a03 + b11 * a13 + b12 * a23 + b13 * a33,\r\n        b20 * a00 + b21 * a10 + b22 * a20 + b23 * a30,\r\n        b20 * a01 + b21 * a11 + b22 * a21 + b23 * a31,\r\n        b20 * a02 + b21 * a12 + b22 * a22 + b23 * a32,\r\n        b20 * a03 + b21 * a13 + b22 * a23 + b23 * a33,\r\n        b30 * a00 + b31 * a10 + b32 * a20 + b33 * a30,\r\n        b30 * a01 + b31 * a11 + b32 * a21 + b33 * a31,\r\n        b30 * a02 + b31 * a12 + b32 * a22 + b33 * a32,\r\n        b30 * a03 + b31 * a13 + b32 * a23 + b33 * a33,\r\n    ];\r\n    expanMatrix(m);\r\n    return m;\r\n    \r\n};\r\nm.clone=function () {\r\n    var a=[];\r\n    for (var i=0;i<16;i++) a[i]=this[i];\r\n    expanMatrix(a);\r\n    return a;\r\n};\r\nm.read=function () {\r\n    var a=[];\r\n    for (var i=0;i<16;i++) a[i]=this[i];\r\n    return a;\r\n};\r\nm.trans=function(tx, ty, tz) {\r\n    var a= [\r\n        1,  0,  0,  0,\r\n        0,  1,  0,  0,\r\n        0,  0,  1,  0,\r\n        tx, ty, tz, 1,\r\n    ];\r\n    return this.multiply(a);\r\n};\r\nm.scale=function(s1,s2, s3) {\r\n    var a= [\r\n        s1,  0,  0,  0,\r\n        0,  s2,  0,  0,\r\n        0,  0,  s3,  0,\r\n        0, 0, 0, 1,\r\n    ];\r\n    return this.multiply(a);\r\n};\r\nm.scl=function (sc) {\r\n    return this.scale(sc,sc,sc);\r\n    \r\n};\r\nm.rotX=function (ang) {\r\n    var c = Math.cos(ang);\r\n    var s = Math.sin(ang);\r\n\r\n    var a=[\r\n        1, 0, 0, 0,\r\n        0, c, s, 0,\r\n        0, -s, c, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n    return this.multiply(a);\r\n    \r\n};\r\nm.rotY=function (ang) {\r\n    var c = Math.cos(ang);\r\n    var s = Math.sin(ang);\r\n\r\n    var a=[\r\n        c, 0, -s, 0,\r\n        0, 1, 0, 0,\r\n        s, 0, c, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n    return this.multiply(a);\r\n    \r\n};\r\nm.rotZ=function (ang) {\r\n    var c = Math.cos(ang);\r\n    var s = Math.sin(ang);\r\n\r\n    var a=[\r\n        c, s, 0, 0,\r\n        -s, c, 0, 0,\r\n        0, 0, 1, 0,\r\n        0, 0, 0, 1,\r\n    ];\r\n    return this.multiply(a);\r\n    \r\n};  \r\n}\r\nvar mt4=function () {\r\nvar mt=[\r\n    1, 0, 0, 0,\r\n    0, 1, 0, 0,\r\n    0, 0, 1, 0,\r\n    0, 0, 0, 1,\r\n];\r\nexpanMatrix(mt)\r\nreturn mt; \r\n};\r\n\r\nfunction triangleS(a,b,c){\r\n\treturn ((b[0]-a[0])*(c[1]-a[1]) - (b[1]-a[1])*(c[0]-a[0])) * .5;\r\n}\r\nvar expan_lineSegmentsIntersect = (l1,l2,zero)=> {\r\n    //console.log(\'22\',l1,l2);\r\n    //x1, y1, x2, y2, x3, y3, x4, y4\r\n    var x1=l1[0][0];var x2=l1[1][0];var y1=l1[0][1];var y2=l1[1][1];\r\n    var x3=l2[0][0];var x4=l2[1][0];var y3=l2[0][1];var y4=l2[1][1];\r\n\r\n    var a_dx = x2 - x1;\r\n    var a_dy = y2 - y1;\r\n    var b_dx = x4 - x3;\r\n    var b_dy = y4 - y3;\r\n     var s = (-a_dy * (x1 - x3) + a_dx * (y1 - y3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    var t = (+b_dx * (y1 - y3) - b_dy * (x1 - x3)) / (-b_dx * a_dy + a_dx * b_dy);\r\n    if (zero ) {\r\n        return (s >= 0 && s <= 1 && t >= 0 && t <= 1) ? [x1 + t * a_dx, y1 + t * a_dy] : false;\r\n    } else return (s > 0 && s < 1 && t > 0 && t < 1) ? [x1 + t * a_dx, y1 + t * a_dy] : false;\r\n};\r\n\r\nfunction read_cord(e){\r\n    var k = e.getAttribute("kor").split(",");\r\n    for (var i=0;i<k.length;i++) k[i] = parseFloat(k[i]);\r\n    return {\r\n        x:k[0],\r\n        y:k[1],\r\n        width:k[2]-k[0],\r\n        height:k[3]-k[1]\r\n    };\r\n};\r\nfunction cosVect(line1,line2){\r\n    //console.log(line1,line2)\r\n    var d = [line2[0][0] - line1[1][0],line2[0][1] - line1[1][1]];\r\n    \r\n    var point = [\r\n        line1[0].slice(),\r\n        line1[1].slice(),\r\n        [line2[1][0]-d[0],line2[1][1]-d[1]]\r\n    ];\r\n    \r\n    var p = (point[0][0] - point[1][0]) * (point[2][0] - point[1][0]) +  (point[0][1] - point[1][1]) * (point[2][1] - point[1][1]);\r\n    var l = Math.sqrt(Math.pow(point[0][0] - point[1][0],2)+Math.pow(point[0][1] - point[1][1],2)) * Math.sqrt(Math.pow(point[2][0] - point[1][0],2)+Math.pow(point[2][1] - point[1][1],2));\r\n    //console.log(p)\r\n    var r = p/l;\r\n   // console.log(r);\r\n    if (r<-1) r = -1;\r\n    if (r>1) r = 1;\r\n   // console.log(r);\r\n    return r;\r\n}; \r\n\n;// CONCATENATED MODULE: ./modul_shapes/src/areal_modul.ts\n\r\n\r\nfunction angHordR(h, r) {\r\n    return Math.asin(lenPoint(h) / 2 / r) * 2 || Math.PI;\r\n}\r\n;\r\nfunction createAreal() {\r\n    var areal = new LayGroupHTML({\r\n        name: "areal",\r\n        resize: function () {\r\n            this.setPosition({\r\n                width: this.html.parentNode.offsetWidth,\r\n                height: this.html.parentNode.offsetHeight,\r\n                left: 0,\r\n                top: 0\r\n            });\r\n            // console.log(this.parent.current_position);\r\n        },\r\n        scroll: function (d) {\r\n            var sc = (1 - d);\r\n            /* setMatrix(\r\n                    new Mt3()\r\n                    .multiply(matrixAreal)\r\n                    .scale(sc,sc)\r\n                ); */\r\n        },\r\n        style: {\r\n            "-webkit-touch-callout": "none",\r\n            "-webkit-user-select": "none",\r\n            "-khtml-user-select": "none",\r\n            "-moz-user-select": "none",\r\n            "-ms-user-select": "none",\r\n            "user-select": "none",\r\n            position: ""\r\n        },\r\n        childrenElem: [\r\n            new LayGroupHTML({\r\n                tag: "svg",\r\n                svg: true,\r\n                resize: function () {\r\n                    this.html.setAttribute("width", this.parent.current_position.width);\r\n                    this.html.setAttribute("height", this.parent.current_position.height);\r\n                },\r\n                childrenElem: [\r\n                    new LayGroupHTML({\r\n                        svg: true,\r\n                        tag: "text",\r\n                        innerHTML: "Здесь будет просмотрщик фигур",\r\n                        resize: function () {\r\n                            expan_write_matrix(this.html, new expan_Mt3().trans(this.parent.wh_parent[0] / 2 - 100, this.parent.wh_parent[1] / 2));\r\n                        }\r\n                    })\r\n                ]\r\n                /* childrenElem:[\r\n                     new LayGroupHTML({\r\n                         name:"gradFigure",\r\n                         svg:true,\r\n                         tag:"defs",\r\n                         childrenElem:[\r\n                             new LayGroupHTML({\r\n                                 elementInsert:billet[\'chil\'][\'backgroundFigure\'].getElementsByTagName("linearGradient")[0],\r\n                                 attribute:{\r\n                                     id:"gradFigure",\r\n                                     x1:"0%",\r\n                                     x2:"100%",\r\n                                     y1:"0%",\r\n                                     y2:"100%",\r\n                                 },\r\n                                 resize:function(){\r\n                                     //"x1","x2","y1","y2",\r\n                                     let at = ["gradientUnits"];\r\n                                     for (let t of at) if (this.html.hasAttribute(t)) this.html.removeAttribute(t);\r\n                                 // write_matrix(this.html,new Mt3().rotX(Math.PI/4))\r\n                                     //console.log(44,this);\r\n                                 }\r\n                             })\r\n                         ]\r\n                         //\r\n                     }),\r\n                     rectBackground,\r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"material",\r\n                         resize:function(){\r\n                             var ps = this.parN(2).current_position;\r\n                             write_matrix(this.html,new Mt3().trans(ps.width/2,ps.height/2).transAr(matrixAreal.elements.slice(6,8)));\r\n                         }\r\n                     }),\r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"arealGradient",\r\n                         style:{\r\n                             "pointer-events":"none"\r\n                         },\r\n                         resize:function(){\r\n                             var ps = this.parN(2).current_position;\r\n                         //.transAr()\r\n                             //console.log();\r\n                             var def = matrixAreal.elements.slice(6,8);\r\n                             write_matrix(this.html,new Mt3().trans(ps.width/2,ps.height/2).transAr(matrixAreal.elements.slice(6,8)));\r\n                         }\r\n                     }),\r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"gridSize",\r\n                         attribute:{\r\n                             opacity:.3,\r\n                             stroke:"#c0f"\r\n                         },\r\n                         resize:function(){\r\n                             var ps = this.parN(2).current_position;\r\n                             write_matrix(this.html,new Mt3().trans(ps.width/2,ps.height/2));\r\n                             createGrid();\r\n                         }\r\n                     }),\r\n                     group,\r\n                     \r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"lineSize",\r\n                         resize:function(){\r\n                             var ps = this.parN(2).current_position;\r\n                         //.transAr()\r\n                             //console.log();\r\n                             var def = matrixAreal.elements.slice(6,8);\r\n                             write_matrix(this.html,new Mt3().trans(ps.width/2,ps.height/2).transAr(matrixAreal.elements.slice(6,8)));\r\n                         }\r\n                     }),\r\n                     \r\n                     new LayGroupHTML({\r\n                         name:"layHole",\r\n                         svg:true,\r\n                         tag:"g",\r\n                         resize:function(){\r\n                             var ps = this.parN(2).current_position;\r\n                             write_matrix(this.html,new Mt3().trans(ps.width/2,ps.height/2));\r\n                         }\r\n                     }),\r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"layerCursorHole",\r\n                         style:{"pointer-events":"none",opacity:0},\r\n                         resize:function(){\r\n                             var cr = read_cord(this.html);\r\n                             write_matrix(this.html,new Mt3().trans(-cr.x-cr.width/2+this.parent.wh_parent[0]/2,-cr.y-cr.height/2+this.parent.wh_parent[1]/2));\r\n                             //console.log(44,this.parent.wh_parent);\r\n                         },\r\n                         elementInsert:billet["chil"][\'cursorHole\']\r\n                     }),\r\n                     new LayGroupHTML({\r\n                         svg:true,\r\n                         tag:"g",\r\n                         name:"virtualMenu",\r\n                         //style:{opacity:0},\r\n                         resize:function(){\r\n                         \r\n                             \r\n                         },\r\n                         //elementInsert:billet[\'chil\'][\'virtualConroll\']\r\n                     }),\r\n                     \r\n                     \r\n                 ]*/\r\n            })\r\n        ]\r\n    });\r\n    /* areal.children[0].child_name[\'lineSize\'].resize();\r\n    areal.children[0].child_name[\'layerEdge\'].resize();\r\n    areal.children[0].child_name[\'material\'].resize();\r\n    areal.children[0].child_name[\'arealGradient\'].resize(); */\r\n    var curentScale = .3;\r\n    var WH = [0, 0];\r\n    var rectBackground = new LayGroupHTML({\r\n        tag: "rect",\r\n        name: "rectBackground",\r\n        svg: true,\r\n        attribute: {\r\n            x: 0,\r\n            y: 0,\r\n            width: 200,\r\n            height: 200,\r\n            fill: "#000",\r\n            opacity: 0.1\r\n        },\r\n        resize: function () {\r\n            this.wh = [this.parN(2).current_position.width, this.parN(2).current_position.height];\r\n            WH = this.wh;\r\n            this.html.setAttribute("width", this.wh[0]);\r\n            this.html.setAttribute("height", this.wh[1]);\r\n        },\r\n        down: {\r\n            fnDown: function (cord) {\r\n                this.curenrOptionDown = {\r\n                    matrixAreal: matrixAreal.clone(),\r\n                    cord: cord.cord\r\n                };\r\n                //closeBlockSelect();\r\n                //console.log("down",);\r\n            },\r\n            fnMove: function (cord) {\r\n                // console.log(this.curenrOptionDown);\r\n                var def = [Math.round(cord.cord[0] - this.curenrOptionDown.cord[0]), Math.round(cord.cord[1] - this.curenrOptionDown.cord[1])];\r\n                setMatrix(new expan_Mt3()\r\n                    .multiply(this.curenrOptionDown.matrixAreal)\r\n                    .trans(def[0], def[1]));\r\n            }\r\n        }\r\n    });\r\n    function stopPropagationRec(event) {\r\n        event.preventDefault ? event.preventDefault() : (event.returnValue = false);\r\n        event.stopPropagation();\r\n    }\r\n    ;\r\n    rectBackground.html[\'addEventListener\']("mousedown", stopPropagationRec);\r\n    rectBackground.html[\'addEventListener\']("touchstart", stopPropagationRec);\r\n    var matrixAreal = new expan_Mt3();\r\n    var mnMxSc = [.2, 4];\r\n    var oldScale = 1;\r\n    function setMatrix(mt) {\r\n        var mn_mx = areal[\'getMinMax\']();\r\n        var scFig = Math.min(WH[0] / (mn_mx[2] - mn_mx[0]), WH[1] / (mn_mx[3] - mn_mx[1]));\r\n        curentScale = ((new expan_Mt3().trans(1000, 0).multiply(mt).elements[6] - mt.elements[6]) / 1000);\r\n        //console.log(mn_mx,WH);* scFig\r\n        if (curentScale < (mnMxSc[0] * scFig)) {\r\n            var sc = ((mnMxSc[0] * scFig) / curentScale);\r\n            setMatrix(new expan_Mt3().multiply(mt).scale(sc, sc));\r\n            return;\r\n        }\r\n        ;\r\n        if (curentScale > (mnMxSc[1] * scFig)) {\r\n            var sc = (mnMxSc[1] * scFig) / curentScale;\r\n            setMatrix(new expan_Mt3().multiply(mt).scale(sc, sc));\r\n            return;\r\n        }\r\n        ;\r\n        var m1 = new expan_Mt3().transAr(mn_mx.slice(0, 2)).multiply(mt).elements.slice(6, 8);\r\n        if (m1[0] > 0) {\r\n            setMatrix(new expan_Mt3().multiply(mt).trans(-m1[0], 0));\r\n            return;\r\n        }\r\n        ;\r\n        if (m1[1] > 0) {\r\n            setMatrix(new expan_Mt3().multiply(mt).trans(0, -m1[1]));\r\n            return;\r\n        }\r\n        ;\r\n        var m1 = new expan_Mt3().transAr(mn_mx.slice(2, 4)).multiply(mt).elements.slice(6, 8);\r\n        if (m1[0] < 0) {\r\n            setMatrix(new expan_Mt3().multiply(mt).trans(-m1[0], 0));\r\n            return;\r\n        }\r\n        ;\r\n        if (m1[1] < 0) {\r\n            setMatrix(new expan_Mt3().multiply(mt).trans(0, -m1[1]));\r\n            return;\r\n        }\r\n        ;\r\n        matrixAreal = mt;\r\n        if (oldScale != curentScale) {\r\n            // for (var e of group.child_name[\'gropeEdge\'].children) e.edge.move();\r\n            // cLineSize()\r\n            /* .then(\r\n                (d)=>console.log("createLineSize",d)\r\n            ); */\r\n        }\r\n        ;\r\n        // console.log(areal.children[0])\r\n        // hole.setMove("");\r\n        //  \r\n        rectBackground.runEvent("colorCursorHole", "");\r\n        //createGrid();\r\n        //el.child_name[\'inputCord\'].setValue([20,30]);\r\n        oldScale = curentScale;\r\n    }\r\n    ;\r\n    function defAreal(def) {\r\n        setMatrix(matrixAreal.trans(def[0], def[1]));\r\n    }\r\n    ;\r\n    return areal;\r\n}\r\n\r\n\n\n//# sourceURL=webpack://@steklo24/shapes/./modul_shapes/src/areal_modul.ts_+_3_modules?')}}]);